 # Hawat

## Nmap

### TCP port scan

```bash
$ ports=$(nmap -p- --min-rate=1000 -T4 192.168.159.147 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)

$ echo $ports
22,17445,30455,50080

$ nmap -p$ports -sV -A 192.168.159.147
Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-08 17:58 JST
Nmap scan report for 192.168.159.147
Host is up (0.24s latency).

PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 8.4 (protocol 2.0)
| ssh-hostkey:
|   3072 78:2f:ea:84:4c:09:ae:0e:36:bf:b3:01:35:cf:47:22 (RSA)
|   256 d2:7d:eb:2d:a5:9a:2f:9e:93:9a:d5:2e:aa:dc:f4:a6 (ECDSA)
|_  256 b6:d4:96:f0:a4:04:e4:36:78:1e:9d:a5:10:93:d7:99 (ED25519)
17445/tcp open  unknown
| fingerprint-strings:
|   GetRequest:
|     HTTP/1.1 200
|     X-Content-Type-Options: nosniff
|     X-XSS-Protection: 1; mode=block
|     Cache-Control: no-cache, no-store, max-age=0, must-revalidate
|     Pragma: no-cache
|     Expires: 0
|     X-Frame-Options: DENY
|     Content-Type: text/html;charset=UTF-8
|     Content-Language: en-US
|     Date: Sun, 08 May 2022 08:58:39 GMT
|     Connection: close
|     <!DOCTYPE html>
|     <html lang="en">
|     <head>
|     <meta charset="UTF-8">
|     <title>Issue Tracker</title>
|     <link href="/css/bootstrap.min.css" rel="stylesheet" />
|     </head>
|     <body>
|     <section>
|     <div class="container mt-4">
|     <span>
|     <div>
|     href="/login" class="btn btn-primary" style="float:right">Sign In</a>
|     href="/register" class="btn btn-primary" style="float:right;margin-right:5px">Register</a>
|     </div>
|     </span>
|     <br><br>
|     <table class="table">
|     <thead>
|     <tr>
|     <th>ID</th>
|     <th>Message</th>
|     <th>P
|   HTTPOptions:
|     HTTP/1.1 200
|     Allow: GET,HEAD,OPTIONS
|     X-Content-Type-Options: nosniff
|     X-XSS-Protection: 1; mode=block
|     Cache-Control: no-cache, no-store, max-age=0, must-revalidate
|     Pragma: no-cache
|     Expires: 0
|     X-Frame-Options: DENY
|     Content-Length: 0
|     Date: Sun, 08 May 2022 08:58:39 GMT
|     Connection: close
|   RTSPRequest:
|     HTTP/1.1 400
|     Content-Type: text/html;charset=utf-8
|     Content-Language: en
|     Content-Length: 435
|     Date: Sun, 08 May 2022 08:58:40 GMT
|     Connection: close
|     <!doctype html><html lang="en"><head><title>HTTP Status 400
|     Request</title><style type="text/css">body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}</style></head><body><h1>HTTP Status 400
|_    Request</h1></body></html>
30455/tcp open  http    nginx 1.18.0
|_http-title: W3.CSS
|_http-server-header: nginx/1.18.0
50080/tcp open  http    Apache httpd 2.4.46 ((Unix) PHP/7.4.15)
|_http-title: W3.CSS Template
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.46 (Unix) PHP/7.4.15
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port17445-TCP:V=7.92%I=7%D=5/8%Time=62778641%P=x86_64-pc-linux-gnu%r(Ge
SF:tRequest,623,"HTTP/1\.1\x20200\x20\r\nX-Content-Type-Options:\x20nosnif
SF:f\r\nX-XSS-Protection:\x201;\x20mode=block\r\nCache-Control:\x20no-cach
SF:e,\x20no-store,\x20max-age=0,\x20must-revalidate\r\nPragma:\x20no-cache
SF:\r\nExpires:\x200\r\nX-Frame-Options:\x20DENY\r\nContent-Type:\x20text/
SF:html;charset=UTF-8\r\nContent-Language:\x20en-US\r\nDate:\x20Sun,\x2008
SF:\x20May\x202022\x2008:58:39\x20GMT\r\nConnection:\x20close\r\n\r\n\n<!D
SF:OCTYPE\x20html>\n<html\x20lang=\"en\">\n\t<head>\n\x20\x20\x20\x20\t<me
SF:ta\x20charset=\"UTF-8\">\n\x20\x20\x20\x20\t<title>Issue\x20Tracker</ti
SF:tle>\n\t\t<link\x20href=\"/css/bootstrap\.min\.css\"\x20rel=\"styleshee
SF:t\"\x20/>\n\t</head>\n\t<body>\n\t\x20\x20\x20\x20<section>\n\t\t<div\x
SF:20class=\"container\x20mt-4\">\n\t\t\t<span>\n\x20\t\t\t\n\t\x20\x20\x2
SF:0\x20\x20\x20\x20\x20<div>\n\t\x20\x20\x20\x20\x20\x20\x20\x20\t<a\x20h
SF:ref=\"/login\"\x20class=\"btn\x20btn-primary\"\x20style=\"float:right\"
SF:>Sign\x20In</a>\x20\n\t\x20\x20\x20\x20\x20\x20\x20\x20\t<a\x20href=\"/
SF:register\"\x20class=\"btn\x20btn-primary\"\x20style=\"float:right;margi
SF:n-right:5px\">Register</a>\n\t\x20\x20\x20\x20\x20\x20\x20\x20</div>\n\
SF:x20\x20\x20\x20\x20\x20\x20\x20</span>\n\t\t\t<br><br>\n\t\t\t<table\x2
SF:0class=\"table\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>ID</th>\n
SF:\t\t\t\t\t<th>Message</th>\n\t\t\t\t\t<th>P")%r(HTTPOptions,12B,"HTTP/1
SF:\.1\x20200\x20\r\nAllow:\x20GET,HEAD,OPTIONS\r\nX-Content-Type-Options:
SF:\x20nosniff\r\nX-XSS-Protection:\x201;\x20mode=block\r\nCache-Control:\
SF:x20no-cache,\x20no-store,\x20max-age=0,\x20must-revalidate\r\nPragma:\x
SF:20no-cache\r\nExpires:\x200\r\nX-Frame-Options:\x20DENY\r\nContent-Leng
SF:th:\x200\r\nDate:\x20Sun,\x2008\x20May\x202022\x2008:58:39\x20GMT\r\nCo
SF:nnection:\x20close\r\n\r\n")%r(RTSPRequest,24E,"HTTP/1\.1\x20400\x20\r\
SF:nContent-Type:\x20text/html;charset=utf-8\r\nContent-Language:\x20en\r\
SF:nContent-Length:\x20435\r\nDate:\x20Sun,\x2008\x20May\x202022\x2008:58:
SF:40\x20GMT\r\nConnection:\x20close\r\n\r\n<!doctype\x20html><html\x20lan
SF:g=\"en\"><head><title>HTTP\x20Status\x20400\x20\xe2\x80\x93\x20Bad\x20R
SF:equest</title><style\x20type=\"text/css\">body\x20{font-family:Tahoma,A
SF:rial,sans-serif;}\x20h1,\x20h2,\x20h3,\x20b\x20{color:white;background-
SF:color:#525D76;}\x20h1\x20{font-size:22px;}\x20h2\x20{font-size:16px;}\x
SF:20h3\x20{font-size:14px;}\x20p\x20{font-size:12px;}\x20a\x20{color:blac
SF:k;}\x20\.line\x20{height:1px;background-color:#525D76;border:none;}</st
SF:yle></head><body><h1>HTTP\x20Status\x20400\x20\xe2\x80\x93\x20Bad\x20Re
SF:quest</h1></body></html>");

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 35.08 seconds
```

### UDP port scan

特に開いているウェルノウンポートは無い．

```bash
$ sudo nmap -Pn -sU --min-rate=10000 192.168.159.147
Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-08 17:50 JST
Nmap scan report for 192.168.159.147
Host is up.
All 1000 scanned ports on 192.168.159.147 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)

Nmap done: 1 IP address (1 host up) scanned in 2.21 seconds
```

## HTTP - 17445 TCP

サポートセンターにありそうな質問が並んだページが表示される．

![image-20220508184353107](/home/funa/.config/Typora/typora-user-images/image-20220508184353107.png)

`gobuster` で隠しディレクトリが無いか調べようとしたが，`302` が返ってくるため調べられなかった．

```bash
$ gobuster dir -u http://192.168.159.147:17445/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.159.147:17445/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/08 18:48:02 Starting gobuster in directory enumeration mode
===============================================================
Error: the server returns a status code that matches the provided options for non existing urls. http://192.168.159.147:17445/0d0ea29e-7ff1-4231-8a07-1f1e6d501c04 => 302 (Length: 0). To continue please exclude the status code, the length or use the --wildcard switch
```

`IssueController.java` のソースコードから，`http://192.168.143.147:17445/issue/checkByPriority?priority=Normal` にアクセスすることでユーザを作成可能であることがわかる．

クエリストリングの `?priority=Normal` は Issue Tracker ページの priority にある `Unbreak` または `Normal` であれば良いと思われる．

![image-20220517214531108](/home/funa/.config/Typora/typora-user-images/image-20220517214531108.png)

url を見ると `/login` だが，新規ユーザの作成を試みる．

## HTTP - 30455 TCP

ECサイトのようなものが表示される．

![image-20220508180443537](/home/funa/.config/Typora/typora-user-images/image-20220508180443537.png)

nginx `1.18.0` の脆弱性を探したが，特に見つからなかった．

`gobuster` で隠しディレクトリを探したが，特に見つからなかった．

```bash
$ gobuster dir -u http://192.168.159.147:30455/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.159.147:30455/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/08 18:04:07 Starting gobuster in directory enumeration mode
===============================================================
/4                    (Status: 301) [Size: 169] [--> http://192.168.159.147:30455/4/]

===============================================================
2022/05/08 18:41:00 Finished
===============================================================
```

wordlist を `/use/share/wordlists/dirb/common.txt` に変えて実行すると，`phpinfo.php` が見つかる．



## HTTP - 50080 TCP

ピザ屋のホームページが表示される．

![image-20220508183934037](/home/funa/.config/Typora/typora-user-images/image-20220508183934037.png)

ページの一番下にフォームがあり，メッセージを送れるようになっている．

![image-20220508184131942](/home/funa/.config/Typora/typora-user-images/image-20220508184131942.png)

`gobuster` で隠しディレクトリが無いか調べると，`cloud` というディレクトリが見つかる．

```bash
$ gobuster dir -u http://192.168.159.147:50080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.159.147:50080/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/08 18:21:40 Starting gobuster in directory enumeration mode
===============================================================
/images               (Status: 301) [Size: 244] [--> http://192.168.159.147:50080/images/]
/4                    (Status: 301) [Size: 239] [--> http://192.168.159.147:50080/4/]
/cloud                (Status: 301) [Size: 243] [--> http://192.168.159.147:50080/cloud/]
Progress: 70152 / 87665 (80.02%)
```

`cloud` にアクセスすると `Nextcloud` というサービスのログインページが表示される．

![image-20220508185415288](/home/funa/.config/Typora/typora-user-images/image-20220508185415288.png)

試しに `admin:admin` でログインするとダッシュボードが表示された．

![image-20220508185721501](/home/funa/.config/Typora/typora-user-images/image-20220508185721501.png)

`issuetracker.zip` をダウンロードし，中身を確認する．

`issuetracker/src/main/java/com/issue/tracker/issues/` に `IssueController.java` というファイルが見つかる．

```java
<snip>
        @GetMapping("/issue/checkByPriority")
        public String checkByPriority(@RequestParam("priority") String priority, Model model) {
                //
                // Custom code, need to integrate to the JPA
                //
            Properties connectionProps = new Properties();
            connectionProps.put("user", "issue_user");
            connectionProps.put("password", "ManagementInsideOld797");
        try {
                        conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/issue_tracker",connectionProps);
                    String query = "SELECT message FROM issue WHERE priority='"+priority+"'";
            System.out.println(query);
                    Statement stmt = conn.createStatement();
                    stmt.executeQuery(query);

        } catch (SQLException e1) {
                        // TODO Auto-generated catch block
                        e1.printStackTrace();
                }

        // TODO: Return the list of the issues with the correct priority
                List<Issue> issues = service.GetAll();
                model.addAttribute("issuesList", issues);
                return "issue_index";

        }
<snip>
```

